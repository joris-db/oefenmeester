<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Myrthe's Oefenmeester</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        :root { --slate-950: #020617; }
        body { 
            background-color: var(--slate-950); 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 0; height: 100vh; overflow: hidden;
            -webkit-tap-highlight-color: transparent; user-select: none; color: white;
        }
        .app-container { height: 100vh; display: flex; flex-direction: column; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .numpad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .scroll-hide::-webkit-scrollbar { display: none; }
        
        .flag-card {
            aspect-ratio: 3 / 2;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 1rem;
            background: #1e293b;
            padding: 4px;
        }
        .flag-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.75rem; }

        @keyframes levelUp {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-levelup { animation: levelUp 0.5s ease-out; }
        
        #map-container { height: 250px; width: 100%; border-radius: 1rem; margin-top: 1rem; border: 2px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const appId = 'myrthe-oefenmeester-v4';

        const germanLidlWords = [
            { nl: "De vergadering", de: "Besprechung" }, { nl: "De afspraak", de: "Termin" }, { nl: "De collega", de: "Kollege" }, { nl: "De afdeling", de: "Abteilung" },
            { nl: "Het kantoor", de: "BÃ¼ro" }, { nl: "De e-mail", de: "E-Mail" }, { nl: "De bijlage", de: "Anhang" }, { nl: "Het verslag", de: "Protokoll" },
            { nl: "De deadline", de: "Frist" }, { nl: "De opdracht", de: "Auftrag" }, { nl: "De planning", de: "Planung" }, { nl: "De strategie", de: "Strategie" },
            { nl: "De doelstelling", de: "Zielsetzung" }, { nl: "Het project", de: "Projekt" }, { nl: "De feedback", de: "RÃ¼ckmeldung" }, { nl: "De presentatie", de: "PrÃ¤sentation" },
            { nl: "De inkoop", de: "Einkauf" }, { nl: "De leverancier", de: "Lieferant" }, { nl: "De onderhandeling", de: "Verhandlung" }, { nl: "De prijs", de: "Preis" },
            { nl: "De klant", de: "Kunde" }, { nl: "De korting", de: "Rabatt" }, { nl: "De factuur", de: "Rechnung" }, { nl: "De voorraad", de: "Lagerbestand" },
            { nl: "De aanbieding", de: "Angebot" }, { nl: "De supermarkt", de: "Supermarkt" }, { nl: "De kassa", de: "Kasse" }, { nl: "De medewerker", de: "Mitarbeiter" },
            { nl: "Het filiaal", de: "Filiale" }, { nl: "De manager", de: "GeschÃ¤ftsfÃ¼hrer" }, { nl: "Het magazijn", de: "Lager" }, { nl: "De vrachtwagen", de: "LKW" },
            { nl: "Het product", de: "Produkt" }, { nl: "De kwaliteit", de: "QualitÃ¤t" }, { nl: "De versheid", de: "Frische" }, { nl: "De verpakking", de: "Verpackung" },
            { nl: "Het schap", de: "Regal" }, { nl: "De mand", de: "Korb" }, { nl: "De kar", de: "Einkaufswagen" }, { nl: "De bon", de: "Quittung" }
        ];

        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    iconRef.current.innerHTML = '';
                    const iconElement = document.createElement('i');
                    iconElement.setAttribute('data-lucide', name);
                    iconElement.style.width = `${size}px`;
                    iconElement.style.height = `${size}px`;
                    if (className) iconElement.setAttribute('class', className);
                    iconRef.current.appendChild(iconElement);
                    window.lucide.createIcons();
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center" />;
        };

        const MapModal = ({ country, onClose }) => {
            const mapInstance = useRef(null);

            useEffect(() => {
                // Kleine timeout zodat de DOM rendering van de container klaar is
                const timer = setTimeout(() => {
                    if (country && country.latlng) {
                        if (mapInstance.current) {
                            mapInstance.current.remove();
                        }
                        mapInstance.current = L.map('map-container').setView(country.latlng, 4);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: 'Â© OpenStreetMap'
                        }).addTo(mapInstance.current);
                        L.marker(country.latlng).addTo(mapInstance.current);
                        
                        // Forceer resize check voor Leaflet
                        setTimeout(() => { mapInstance.current.invalidateSize(); }, 200);
                    }
                }, 100);

                return () => {
                    clearTimeout(timer);
                    if (mapInstance.current) mapInstance.current.remove();
                };
            }, [country]);

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-md">
                    <div className="w-full max-w-sm glass rounded-[2.5rem] p-6 flex flex-col items-center gap-4">
                        <div className="flex justify-between w-full items-center">
                            <h3 className="text-xl font-black italic uppercase text-emerald-400">{country.name}</h3>
                            <button onClick={onClose} className="bg-white/10 p-2 rounded-full"><Icon name="x" size={20} /></button>
                        </div>
                        <div id="map-container" className="shadow-2xl"></div>
                        <button onClick={onClose} className="w-full bg-emerald-600 p-4 rounded-2xl font-black uppercase text-sm mt-2 active:scale-95">Volgende</button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('menu');
            const [countries, setCountries] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const [lastWords, setLastWords] = useState([]); 
            const [showMap, setShowMap] = useState(null);
            
            const [stats, setStats] = useState(() => {
                const saved = localStorage.getItem(`${appId}_stats`);
                return saved ? JSON.parse(saved) : {
                    xp: 0, level: 1, streak: 0, lastDate: null,
                    correctMath: 0, correctGerman: 0, correctFlags: 0,
                    mathLevel: 1, flagBestStreak: 0
                };
            });

            const [examState, setExamState] = useState(null);
            const [streakCount, setStreakCount] = useState(0);
            const [mathProblem, setMathProblem] = useState({ q: '', a: 0 });
            const [userAnswer, setUserAnswer] = useState('');
            const [mathStreak, setMathStreak] = useState(0);
            const [selectedTypes, setSelectedTypes] = useState({ plus: true, min: true, keer: false, gedeeld: false });
            const [currentProblem, setCurrentProblem] = useState(null);

            const getXpThreshold = (level) => Math.floor(100 * Math.pow(1.1, level - 1));

            useEffect(() => {
                localStorage.setItem(`${appId}_stats`, JSON.stringify(stats));
            }, [stats]);

            useEffect(() => {
                fetch('https://restcountries.com/v3.1/all?fields=name,flags,translations,latlng')
                    .then(r => r.json())
                    .then(data => {
                        const formatted = data.map(c => ({
                            name: c.translations.nld?.common || c.name.common,
                            flag: c.flags.svg,
                            latlng: c.latlng
                        })).filter(c => c.name && c.flag && c.latlng.length > 0);
                        setCountries(formatted);
                    });
            }, []);

            const speakGerman = (text) => {
                window.speechSynthesis.cancel(); // Stop huidige spraak
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Zoek specifiek naar een Duitse stem
                const voices = window.speechSynthesis.getVoices();
                const deVoice = voices.find(v => v.lang.startsWith('de')) || voices.find(v => v.name.includes('German'));
                
                if (deVoice) utterance.voice = deVoice;
                utterance.lang = 'de-DE';
                utterance.rate = 0.85;
                window.speechSynthesis.speak(utterance);
            };

            const addXP = (amount, categoryKey) => {
                setStats(prev => {
                    let newXP = prev.xp + amount;
                    let currentLevel = prev.level;
                    let threshold = getXpThreshold(currentLevel);
                    while (newXP >= threshold) {
                        newXP -= threshold;
                        currentLevel++;
                        threshold = getXpThreshold(currentLevel);
                        setFeedback({ type: 'success', text: `LEVEL UP! Level ${currentLevel} ðŸŽ‰` });
                    }
                    const updates = { ...prev, xp: newXP, level: currentLevel };
                    if (categoryKey) updates[categoryKey] = (prev[categoryKey] || 0) + 1;
                    return updates;
                });
            };

            const generateMathProblem = (level, types = null) => {
                const opsPool = types || Object.keys(selectedTypes).filter(k => selectedTypes[k]);
                const type = opsPool[Math.floor(Math.random() * opsPool.length)];
                let n1, n2, q, a;
                const minVal = Math.max(2, Math.floor(level / 2));
                switch(type) {
                    case 'plus': n1 = Math.floor(Math.random() * (level * 15)) + minVal; n2 = Math.floor(Math.random() * (level * 15)) + minVal; q = `${n1} + ${n2}`; a = n1 + n2; break;
                    case 'min': n1 = Math.floor(Math.random() * (level * 15)) + (minVal * 2); n2 = Math.floor(Math.random() * (n1 - minVal)) + minVal; q = `${n1} - ${n2}`; a = n1 - n2; break;
                    case 'keer': n1 = Math.floor(Math.random() * 10) + 1; n2 = Math.floor(Math.random() * 10) + 1; q = `${n1} Ã— ${n2}`; a = n1 * n2; break;
                    case 'gedeeld': n2 = Math.floor(Math.random() * 9) + 2; a = Math.floor(Math.random() * 10) + 1; n1 = n2 * a; q = `${n1} : ${n2}`; break;
                }
                return { q, a };
            };

            const generateGermanProblem = () => {
                const availableWords = germanLidlWords.filter(w => !lastWords.includes(w.de));
                const pool = availableWords.length > 0 ? availableWords : germanLidlWords;
                const correct = pool[Math.floor(Math.random() * pool.length)];
                setLastWords(prev => [correct.de, ...prev].slice(0, 10));

                let opts = [correct.de];
                while(opts.length < 4) {
                    const r = germanLidlWords[Math.floor(Math.random() * germanLidlWords.length)].de;
                    if(!opts.includes(r)) opts.push(r);
                }
                return { ...correct, opts: opts.sort(() => Math.random() - 0.5), category: 'german' };
            };

            const generateFlagProblemData = () => {
                if (!countries.length) return null;
                const correct = countries[Math.floor(Math.random() * countries.length)];
                let opts = [correct];
                while(opts.length < 4) {
                    const r = countries[Math.floor(Math.random() * countries.length)];
                    if(!opts.find(o => o.name === r.name)) opts.push(r);
                }
                const mode = Math.random() > 0.5 ? 1 : 0; 
                return { ...correct, opts: opts.sort(() => Math.random() - 0.5), category: 'flags', mode };
            };

            const handleChoiceAnswer = (ans) => {
                if (feedback) return;
                
                let isCorrect = false;
                if (currentProblem.category === 'german') {
                    isCorrect = ans === currentProblem.de;
                } else {
                    // Bij vlaggen: mode 0 is vlag kiezen bij naam, mode 1 is naam kiezen bij vlag
                    isCorrect = (currentProblem.mode === 0) ? (ans.name === currentProblem.name) : (ans === currentProblem.name);
                }

                if (view === 'exam-choice') {
                    nextExamQuestion(isCorrect);
                    return;
                }

                if (view === 'flag-streak') {
                    if (isCorrect) {
                        const newStreak = streakCount + 1;
                        setStreakCount(newStreak);
                        if (newStreak > stats.flagBestStreak) setStats(prev => ({ ...prev, flagBestStreak: newStreak }));
                        addXP(5, 'correctFlags');
                        setFeedback({ type: 'success', text: `Streak: ${newStreak}! ðŸ”¥` });
                        setTimeout(() => { setShowMap(currentProblem); setFeedback(null); }, 600);
                    } else {
                        setFeedback({ type: 'error', text: `Helaas! Dit was ${currentProblem.name}.` });
                        setTimeout(() => setShowMap(currentProblem), 1500);
                    }
                    return;
                }

                if (isCorrect) {
                    if (currentProblem.category === 'german') {
                        speakGerman(currentProblem.de);
                        addXP(15, 'correctGerman');
                        setFeedback({ type: 'success', text: 'Richtig! ðŸ‡©ðŸ‡ª' });
                        setTimeout(() => { setFeedback(null); setCurrentProblem(generateGermanProblem()); }, 1200);
                    } else {
                        addXP(15, 'correctFlags');
                        setFeedback({ type: 'success', text: 'Lekker bezig! âœ¨' });
                        setTimeout(() => { setShowMap(currentProblem); setFeedback(null); }, 600);
                    }
                } else {
                    const text = (currentProblem.category === 'german') 
                        ? `Jammer! Het was ${currentProblem.de}` 
                        : `Nee, dit is de vlag van ${currentProblem.name}`;
                    setFeedback({ type: 'error', text });
                    setTimeout(() => setFeedback(null), 2500);
                }
            };

            const closeMap = () => {
                setShowMap(null);
                if (view === 'flag-streak' && feedback?.type === 'error') {
                    setView('menu');
                } else {
                    setCurrentProblem(generateFlagProblemData());
                }
                setFeedback(null);
            };

            const startMathGame = useCallback(() => {
                setMathProblem(generateMathProblem(stats.mathLevel));
                setUserAnswer('');
                setFeedback(null);
                setView('math-game');
            }, [selectedTypes, stats.mathLevel]);

            const startGermanGame = () => {
                setCurrentProblem(generateGermanProblem());
                setFeedback(null);
                setView('german-game');
            };

            const startFlagGame = () => {
                setCurrentProblem(generateFlagProblemData());
                setFeedback(null);
                setView('flags-game');
            };

            const startStreakMode = () => {
                setStreakCount(0);
                setCurrentProblem(generateFlagProblemData());
                setFeedback(null);
                setView('flag-streak');
            };

            const startExam = (type) => {
                setExamState({ type, currentQuestion: 1, correctCount: 0, totalQuestions: 40, level: stats.mathLevel });
                if (type === 'math') {
                    setMathProblem(generateMathProblem(stats.mathLevel, ['plus', 'min', 'keer', 'gedeeld']));
                    setUserAnswer('');
                    setView('exam-math');
                } else {
                    setCurrentProblem(type === 'german' ? generateGermanProblem() : generateFlagProblemData());
                    setView('exam-choice');
                }
                setFeedback(null);
            };

            const nextExamQuestion = (isCorrect) => {
                const newCorrectCount = isCorrect ? examState.correctCount + 1 : examState.correctCount;
                if (examState.currentQuestion >= examState.totalQuestions) {
                    const percentage = Math.round((newCorrectCount / examState.totalQuestions) * 100);
                    setExamState(prev => ({ ...prev, correctCount: newCorrectCount, finished: true, passed: percentage >= 85, percentage }));
                    setView('exam-result');
                } else {
                    setExamState(prev => ({ ...prev, currentQuestion: prev.currentQuestion + 1, correctCount: newCorrectCount }));
                    if (examState.type === 'math') {
                        setMathProblem(generateMathProblem(examState.level, ['plus', 'min', 'keer', 'gedeeld']));
                        setUserAnswer('');
                    } else {
                        setCurrentProblem(examState.type === 'german' ? generateGermanProblem() : generateFlagProblemData());
                    }
                }
            };

            const handleMathAnswer = () => {
                if (feedback || !userAnswer) return;
                const isCorrect = parseInt(userAnswer) === mathProblem.a;
                if (view === 'exam-math') { nextExamQuestion(isCorrect); return; }
                if (isCorrect) {
                    addXP(20, 'correctMath');
                    setMathStreak(s => (s + 1 >= 5 ? 0 : s + 1));
                    if (mathStreak + 1 >= 5) setStats(prev => ({...prev, mathLevel: prev.mathLevel + 1}));
                    setFeedback({type:'success', text:'Lekker hoor! âœ¨'});
                    setTimeout(startMathGame, 800);
                } else {
                    setFeedback({type:'error', text:`Nee, het was ${mathProblem.a}`});
                    setMathStreak(0);
                    setTimeout(() => {setFeedback(null); setUserAnswer('');}, 2000);
                }
            };

            const Header = ({ title, onBack }) => (
                <div className="pt-12 pb-4 px-6 flex justify-between items-center bg-slate-900/90 border-b border-white/5 sticky top-0 z-50">
                    <button onClick={onBack} className="text-slate-400 p-2 active:scale-90"><Icon name="chevron-left" size={24} /></button>
                    <div className="text-center">
                        <h2 className="text-[10px] font-black uppercase tracking-widest text-slate-500 italic">{title}</h2>
                        <div className="flex items-center justify-center gap-1 text-orange-500 font-bold text-xs">
                            <Icon name="flame" size={14} /> {stats.streak} dag streak
                        </div>
                    </div>
                    <button onClick={() => setView('achievements')} className="bg-indigo-500/10 text-indigo-400 px-3 py-1 rounded-full border border-indigo-500/20 font-black text-xs">
                        LVL {stats.level}
                    </button>
                </div>
            );

            if (view === 'menu') {
                return (
                    <div className="app-container p-6 flex flex-col items-center overflow-y-auto scroll-hide">
                        <div className="w-full max-w-sm pt-8 mb-8 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="w-14 h-14 bg-indigo-600 rounded-[1.25rem] flex items-center justify-center shadow-lg font-black text-2xl">M</div>
                                <div><p className="text-[10px] font-black text-slate-500 uppercase">Myrthe's</p><p className="text-xl font-black italic uppercase tracking-tighter">Oefenmeester</p></div>
                            </div>
                            <button onClick={() => setView('achievements')} className="w-12 h-12 glass rounded-2xl flex items-center justify-center text-orange-400"><Icon name="trophy" size={20} /></button>
                        </div>
                        <div className="w-full max-w-sm space-y-4">
                            <h3 className="text-xs font-black uppercase text-slate-500 tracking-widest">Kies een vak</h3>
                            <button onClick={() => setView('math-category')} className="w-full glass p-6 rounded-[2rem] flex items-center gap-6 active:scale-95 border-l-4 border-indigo-500"><div className="bg-indigo-600 p-4 rounded-2xl shadow-lg"><Icon name="calculator" size={28} /></div><div className="text-left"><span className="block text-xl font-black italic uppercase">Rekenen</span><span className="text-[10px] font-bold text-slate-500 uppercase">Plus, min, keer & gedeeld</span></div></button>
                            <button onClick={() => setView('german-category')} className="w-full glass p-6 rounded-[2rem] flex items-center gap-6 active:scale-95 border-l-4 border-rose-500"><div className="bg-rose-600 p-4 rounded-2xl shadow-lg"><Icon name="languages" size={28} /></div><div className="text-left"><span className="block text-xl font-black italic uppercase">Duits</span><span className="text-[10px] font-bold text-slate-500 uppercase">Lidl woorden oefenen</span></div></button>
                            <button onClick={() => setView('flags-category')} className="w-full glass p-6 rounded-[2rem] flex items-center gap-6 active:scale-95 border-l-4 border-emerald-500"><div className="bg-emerald-600 p-4 rounded-2xl shadow-lg"><Icon name="flag" size={28} /></div><div className="text-left"><span className="block text-xl font-black italic uppercase">Vlaggen</span><span className="text-[10px] font-bold text-slate-500 uppercase">Landen van de wereld</span></div></button>
                        </div>
                    </div>
                );
            }

            if (view === 'math-setup') {
                return (
                    <div className="app-container">
                        <Header title="Training" onBack={() => setView('math-category')} />
                        <div className="p-8 flex flex-col gap-4 flex-1 justify-center max-w-sm mx-auto w-full">
                            <h3 className="text-2xl font-black italic uppercase text-center mb-4">Kies je sommen</h3>
                            <div className="grid grid-cols-2 gap-4">
                                {['plus', 'min', 'keer', 'gedeeld'].map(t => (
                                    <button key={t} onClick={() => setSelectedTypes(p => ({...p, [t]: !p[t]}))} className={`p-6 rounded-3xl border-2 transition-all font-black uppercase text-[10px] flex flex-col items-center gap-2 ${selectedTypes[t] ? 'bg-indigo-600 border-indigo-400' : 'bg-slate-900 border-white/5 opacity-40'}`}>
                                        <span className="text-2xl font-bold">{t === 'plus' ? '+' : t === 'min' ? '-' : t === 'keer' ? 'Ã—' : ':'}</span>{t}
                                    </button>
                                ))}
                            </div>
                            <button onClick={startMathGame} className="mt-8 bg-white text-slate-950 p-6 rounded-[2rem] font-black text-xl italic uppercase shadow-xl active:scale-95">Start Oefenen! ðŸš€</button>
                        </div>
                    </div>
                );
            }

            if (view === 'math-game' || view === 'exam-math') {
                const isExam = view === 'exam-math';
                return (
                    <div className="app-container">
                        <Header title={isExam ? `Toets: ${examState.currentQuestion}/40` : "Sommen"} onBack={() => setView(isExam ? 'math-category' : 'math-setup')} />
                        <div className="flex-1 flex flex-col items-center justify-center p-6 text-center">
                            {!isExam && <div className="flex gap-2 mb-6">{[...Array(5)].map((_, i) => (<div key={i} className={`w-3 h-3 rounded-full ${i < mathStreak ? 'bg-indigo-400' : 'bg-slate-800'}`} />))}</div>}
                            <div className="text-7xl font-black mb-10 tracking-tighter drop-shadow-2xl">{mathProblem.q}</div>
                            <div className="text-5xl font-mono bg-slate-900 w-full max-w-[240px] py-6 rounded-[2.5rem] border-2 border-indigo-500/30 flex items-center justify-center text-indigo-400 shadow-inner">{userAnswer || "?"}</div>
                            <div className="h-16 mt-6">{feedback && <div className={`font-black uppercase text-center px-8 py-3 rounded-2xl shadow-xl ${feedback.type === 'success' ? 'bg-emerald-500 animate-levelup' : 'bg-rose-500'}`}>{feedback.text}</div>}</div>
                        </div>
                        <div className="bg-slate-900/95 p-6 pb-12 rounded-t-[3rem] glass border-t border-white/5"><div className="numpad-grid max-w-xs mx-auto">{[1,2,3,4,5,6,7,8,9,'C',0,'OK'].map(b => (<button key={b} onClick={() => { if(b === 'OK') handleMathAnswer(); else if(b === 'C') setUserAnswer(''); else if(userAnswer.length < 5) setUserAnswer(userAnswer + b); }} className="h-16 rounded-2xl bg-white/5 font-black text-2xl active:bg-white/20 shadow-lg border border-white/5">{b}</button>))}</div></div>
                    </div>
                );
            }

            if (view === 'german-game' || view === 'flags-game' || view === 'exam-choice' || view === 'flag-streak') {
                const isFlags = (currentProblem.category === 'flags');
                const isStreak = view === 'flag-streak';

                return (
                    <div className="app-container">
                        {showMap && <MapModal country={showMap} onClose={closeMap} />}
                        <Header title={isStreak ? "Streak Mode" : (isFlags ? "Vlaggen" : "Duits")} onBack={() => setView('menu')} />
                        <div className="flex-1 flex flex-col p-8 items-center justify-start gap-6 text-center overflow-y-auto pt-8 scroll-hide">
                            {isStreak && <div className="bg-orange-500/20 text-orange-400 px-4 py-2 rounded-full font-black text-sm border border-orange-500/30">Streak: {streakCount}</div>}
                            
                            <div className="space-y-2">
                                <span className="text-slate-500 uppercase text-[10px] font-black tracking-widest italic">
                                    {isFlags ? (currentProblem.mode === 0 ? "Zoek de vlag van" : "Welk land is dit?") : "Duitse vertaling van"}
                                </span>
                                <div className="flex flex-col items-center gap-4">
                                    {isFlags && currentProblem.mode === 1 ? (
                                        <div className="flag-card w-64 shadow-2xl border-2 border-white/10">
                                            <img src={currentProblem.flag} className="flag-img" />
                                        </div>
                                    ) : (
                                        <h2 className={`text-3xl font-black italic tracking-tighter leading-tight ${isFlags ? 'text-emerald-400' : 'text-rose-400'}`}>
                                            {isFlags ? currentProblem.name : currentProblem.nl}
                                        </h2>
                                    )}
                                </div>
                            </div>
                            
                            <div className={`grid ${isFlags && currentProblem.mode === 0 ? 'grid-cols-2' : 'grid-cols-1'} gap-4 w-full max-w-sm`}>
                                {currentProblem.opts.map((o, i) => (
                                    <button key={i} onClick={() => handleChoiceAnswer(o)} className={`${isFlags && currentProblem.mode === 0 ? 'flag-card active:scale-95' : 'p-5 rounded-[1.5rem] font-bold text-lg active:scale-95'} glass border-2 border-transparent active:border-white/40 transition-all`}>
                                        {isFlags ? (currentProblem.mode === 0 ? <img src={o.flag} className="flag-img" /> : o.name) : o}
                                    </button>
                                ))}
                            </div>

                            <div className="h-16 mt-4">
                                {feedback && <div className={`font-black uppercase px-8 py-3 rounded-2xl shadow-2xl ${feedback.type === 'success' ? 'bg-emerald-500 animate-levelup' : 'bg-rose-500'}`}>{feedback.text}</div>}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'exam-result') {
                return (
                    <div className="app-container flex flex-col items-center justify-center p-8 text-center">
                        <div className={`w-32 h-32 rounded-full flex items-center justify-center mb-6 shadow-2xl ${examState.passed ? 'bg-emerald-500 shadow-emerald-500/20' : 'bg-rose-500 shadow-rose-500/20'}`}><Icon name={examState.passed ? "check" : "x"} size={64} /></div>
                        <h2 className="text-4xl font-black italic uppercase mb-2 tracking-tighter">{examState.passed ? 'Geslaagd!' : 'Gezakt...'}</h2>
                        <div className="text-6xl font-black text-white/90 mb-4">{examState.percentage}%</div>
                        <button onClick={() => setView('menu')} className="w-full max-w-sm bg-indigo-600 p-5 rounded-3xl font-black uppercase italic active:scale-95">Terug naar menu</button>
                    </div>
                );
            }
            
            if (view === 'achievements') {
                return (
                    <div className="app-container">
                        <Header title="Statistieken" onBack={() => setView('menu')} />
                        <div className="flex-1 overflow-y-auto p-6 scroll-hide">
                            <div className="grid grid-cols-2 gap-4">
                                <div className="glass p-6 rounded-3xl text-center shadow-xl"><div className="text-orange-500 mb-2 flex justify-center"><Icon name="flame" size={32} /></div><div className="text-2xl font-black">{stats.streak}</div><div className="text-[10px] font-bold text-slate-500 uppercase">Streak</div></div>
                                <div className="glass p-6 rounded-3xl text-center shadow-xl"><div className="text-indigo-500 mb-2 flex justify-center"><Icon name="star" size={32} /></div><div className="text-2xl font-black">{stats.level}</div><div className="text-[10px] font-bold text-slate-500 uppercase">Level</div></div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Fallback for missing category views
            if (view.includes('-category')) {
                const type = view.split('-')[0];
                const config = {
                    math: { title: "Rekenen", color: "indigo", opts: [{ name: 'Training', desc: 'Oefenen', icon: 'graduation-cap', action: () => setView('math-setup') }, { name: 'Toets', desc: '40 vragen', icon: 'scroll-text', action: () => startExam('math') }] },
                    german: { title: "Duits", color: "rose", opts: [{ name: 'Oefenen', desc: 'Woorden leren', icon: 'book-open', action: startGermanGame }, { name: 'Toets', desc: '40 vragen', icon: 'scroll-text', action: () => startExam('german') }] },
                    flags: { title: "Vlaggen", color: "emerald", opts: [{ name: 'Oefenen', desc: 'Alle landen', icon: 'globe', action: startFlagGame }, { name: 'Streak', desc: `Record: ${stats.flagBestStreak}`, icon: 'zap', action: startStreakMode }, { name: 'Toets', desc: '40 landen', icon: 'scroll-text', action: () => startExam('flags') }] }
                }[type];
                
                return (
                    <div className="app-container">
                        <Header title={config.title} onBack={() => setView('menu')} />
                        <div className="p-8 flex flex-col gap-6 justify-center flex-1 max-w-sm mx-auto w-full">
                            {config.opts.map((opt, i) => (
                                <button key={i} onClick={opt.action} className={`w-full glass p-6 rounded-[2.5rem] flex items-center gap-6 active:scale-95 border-b-4 border-${config.color}-500/50`}>
                                    <div className={`bg-${config.color}-600 p-4 rounded-2xl shadow-lg`}><Icon name={opt.icon} size={24} /></div>
                                    <div className="text-left"><span className="block text-xl font-black italic uppercase">{opt.name}</span><span className="text-[10px] font-bold text-slate-500 uppercase">{opt.desc}</span></div>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>