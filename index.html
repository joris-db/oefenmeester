<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Myrthe's Oefenmeester</title>

    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/joris-db/oefenmeester/refs/heads/main/icon.png">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/joris-db/oefenmeester/refs/heads/main/icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Oefenmeester">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="manifest" href='data:application/manifest+json,{"name":"Myrthes Oefenmeester","short_name":"Oefenmeester","start_url":".","display":"standalone","background_color":"#020617","theme_color":"#020617","icons":[{"src":"https://raw.githubusercontent.com/joris-db/oefenmeester/refs/heads/main/icon.png","sizes":"512x512","type":"image/png"}]}'>

    <script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.async=1;js.src = "https://cdn.webpushr.com/app.min.js";
    fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));
    webpushr('setup',{'key':'BE3We82PbRdwBzZZ5c0SwG7iysKjYc8MLkVwgzVVv2OyBtmM8Zt-JqDP63PmxZY1KyjfIXv3OhBb4kEWmlbz0Mw' });</script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root { --slate-950: #020617; --slate-900: #0f172a; }
        body { 
            background-color: var(--slate-950); 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 0; height: 100vh; height: -webkit-fill-available; overflow: hidden;
            -webkit-tap-highlight-color: transparent; user-select: none; color: white;
        }
        .app-container { height: 100vh; height: -webkit-fill-available; display: flex; flex-direction: column; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .pop-in { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .map-container svg { width: 100%; height: auto; max-height: 280px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); }
        .province-active { fill: #fbbf24 !important; stroke: #fff !important; stroke-width: 2px; }
        .province-default { fill: #1e293b; stroke: #475569; stroke-width: 1px; transition: fill 0.3s; }
        .numpad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const topoQuestions = {
            nederland: [
                { id: 'GR', name: 'Groningen', path: "M250,20 L280,30 L285,60 L260,75 L230,60 Z" },
                { id: 'FR', name: 'Friesland', path: "M180,30 L230,30 L245,65 L210,85 L170,80 Z" },
                { id: 'DR', name: 'Drenthe', path: "M240,75 L280,75 L275,120 L230,120 L220,95 Z" },
                { id: 'OV', name: 'Overijssel', path: "M210,120 L270,125 L280,170 L220,185 L200,160 Z" },
                { id: 'FL', name: 'Flevoland', path: "M180,100 L210,105 L220,140 L175,150 Z" },
                { id: 'NH', name: 'Noord-Holland', path: "M130,50 L170,60 L185,120 L140,140 L120,100 Z" },
                { id: 'ZH', name: 'Zuid-Holland', path: "M100,150 L145,150 L160,200 L110,210 Z" },
                { id: 'UT', name: 'Utrecht', path: "M160,155 L195,155 L200,185 L155,190 Z" },
                { id: 'GL', name: 'Gelderland', path: "M180,185 L220,190 L260,220 L210,250 L160,220 Z" },
                { id: 'ZE', name: 'Zeeland', path: "M50,220 L100,220 L105,260 L60,270 Z" },
                { id: 'NB', name: 'Noord-Brabant', path: "M110,225 L200,235 L220,275 L115,280 Z" },
                { id: 'LI', name: 'Limburg', path: "M210,260 L240,270 L230,340 L205,330 Z" }
            ],
            europa: [
                { id: 'FR', name: 'Frankrijk', path: "M100,180 L160,180 L170,240 L90,250 Z" },
                { id: 'DE', name: 'Duitsland', path: "M170,130 L220,130 L230,190 L165,190 Z" },
                { id: 'ES', name: 'Spanje', path: "M40,260 L100,260 L90,320 L30,310 Z" },
                { id: 'IT', name: 'ItaliÃ«', path: "M180,245 L210,240 L240,310 L210,320 Z" },
                { id: 'UK', name: 'Verenigd Koninkrijk', path: "M80,80 L120,80 L115,140 L70,135 Z" },
                { id: 'PL', name: 'Polen', path: "M230,135 L280,140 L285,185 L230,190 Z" },
                { id: 'NO', name: 'Noorwegen', path: "M160,20 L190,20 L180,100 L150,90 Z" },
                { id: 'SE', name: 'Zweden', path: "M195,30 L225,30 L220,110 L185,110 Z" }
            ]
        };

        const germanLidlData = [
            { nl: "Wil je de kassabon mee?", de: "MÃ¶chten Sie den Kassenbon?" },
            { nl: "Heeft u een klantenkaart?", de: "Haben Sie eine Kundenkarte?" },
            { nl: "Dat is dan â‚¬12,50.", de: "Das macht dann zwÃ¶lf Euro fÃ¼nfzig." },
            { nl: "Helaas, dit product is uitverkocht.", de: "Leider ist dieses Produkt ausverkauft." },
            { nl: "De statiegeldautomaat is daar.", de: "Der Pfandautomat ist dort drÃ¼ben." },
            { nl: "Alstublieft, uw wisselgeld.", de: "Bitte sehr, Ihr Wechselgeld." },
            { nl: "Wilt u een tasje erbij?", de: "MÃ¶chten Sie eine TÃ¼te dazu?" },
            { nl: "Fijne avond nog!", de: "SchÃ¶nen Feierabend noch!" }
        ];

        const Icon = ({ name, size = 24 }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    iconRef.current.innerHTML = '';
                    const iconElement = document.createElement('i');
                    iconElement.setAttribute('data-lucide', name);
                    iconElement.style.width = `${size}px`;
                    iconElement.style.height = `${size}px`;
                    iconRef.current.appendChild(iconElement);
                    window.lucide.createIcons({ attrs: { strokeWidth: 2, width: size, height: size } });
                }
            }, [name, size]);
            return <span ref={iconRef} className="inline-flex items-center justify-center" />;
        };

        const App = () => {
            const [view, setView] = useState('menu');
            const [score, setScore] = useState(() => Number(localStorage.getItem('myrthe_score')) || 0);
            const [mathLevel, setMathLevel] = useState(() => Number(localStorage.getItem('myrthe_level')) || 1);
            const [mathStreak, setMathStreak] = useState(0);
            const [selectedTypes, setSelectedTypes] = useState({ plus: true, min: true, keer: false, gedeeld: false });
            const [mathProblem, setMathProblem] = useState({ q: '', a: 0 });
            const [userAnswer, setUserAnswer] = useState('');
            const [feedback, setFeedback] = useState(null);
            const [countries, setCountries] = useState([]);
            const [currentProblem, setCurrentProblem] = useState(null);

            useEffect(() => { localStorage.setItem('myrthe_score', score); localStorage.setItem('myrthe_level', mathLevel); }, [score, mathLevel]);

            useEffect(() => {
                fetch('https://restcountries.com/v3.1/all?fields=name,translations,flags')
                    .then(res => res.json())
                    .then(data => {
                        const list = data.map(c => ({ 
                            name: c.translations?.nld?.common || c.name.common, 
                            flag: c.flags.svg || c.flags.png 
                        })).filter(c => c.name && c.flag);
                        setCountries(list);
                    });
            }, []);

            const generateMath = useCallback(() => {
                const ops = Object.keys(selectedTypes).filter(k => selectedTypes[k]);
                const type = ops.length > 0 ? ops[Math.floor(Math.random() * ops.length)] : 'plus';
                let n1, n2, q, a;
                const minVal = Math.max(2, Math.floor(mathLevel / 2));
                switch(type) {
                    case 'plus': n1 = Math.floor(Math.random() * (mathLevel * 15)) + minVal; n2 = Math.floor(Math.random() * (mathLevel * 15)) + minVal; q = `${n1} + ${n2}`; a = n1 + n2; break;
                    case 'min': n1 = Math.floor(Math.random() * (mathLevel * 15)) + (minVal * 2); n2 = Math.floor(Math.random() * (n1 - minVal)) + minVal; q = `${n1} - ${n2}`; a = n1 - n2; break;
                    case 'keer': n1 = Math.floor(Math.random() * 10) + 1; n2 = Math.floor(Math.random() * 10) + 1; q = `${n1} Ã— ${n2}`; a = n1 * n2; break;
                    case 'gedeeld': n2 = Math.floor(Math.random() * 9) + 2; a = Math.floor(Math.random() * 10) + 1; n1 = n2 * a; q = `${n1} : ${n2}`; break;
                }
                setMathProblem({ q, a });
                setUserAnswer('');
                setFeedback(null);
                setView('math-game');
            }, [selectedTypes, mathLevel]);

            const generateFlag = useCallback(() => {
                if (countries.length < 4) return;
                const correct = countries[Math.floor(Math.random() * countries.length)];
                let opts = [correct];
                while(opts.length < 4) {
                    const r = countries[Math.floor(Math.random() * countries.length)];
                    if(!opts.find(o => o.name === r.name)) opts.push(r);
                }
                setCurrentProblem({ q: correct.name, a: correct.name, opts: opts.sort(() => Math.random() - 0.5), category: 'flags' });
                setFeedback(null);
                setView('flag-game');
            }, [countries]);

            const generateTopo = (cat) => {
                const pool = topoQuestions[cat];
                const correct = pool[Math.floor(Math.random() * pool.length)];
                let opts = [correct.name];
                while(opts.length < 4) {
                    const r = pool[Math.floor(Math.random() * pool.length)].name;
                    if(!opts.includes(r)) opts.push(r);
                }
                setCurrentProblem({ ...correct, opts: opts.sort(() => Math.random() - 0.5), category: cat });
                setFeedback(null);
                setView('topo-game');
            };

            const generateGerman = () => {
                const correct = germanLidlData[Math.floor(Math.random() * germanLidlData.length)];
                let opts = [correct.de];
                while(opts.length < 4) {
                    const r = germanLidlData[Math.floor(Math.random() * germanLidlData.length)].de;
                    if(!opts.includes(r)) opts.push(r);
                }
                setCurrentProblem({ ...correct, opts: opts.sort(() => Math.random() - 0.5), category: 'german' });
                setFeedback(null);
                setView('german-game');
            };

            const handleAnswer = (ans) => {
                let isCorrect = false;
                if (currentProblem.category === 'german') isCorrect = currentProblem.de === ans;
                else if (currentProblem.category === 'flags') isCorrect = currentProblem.a === ans;
                else isCorrect = currentProblem.name === ans;

                if (isCorrect) {
                    setScore(s => s + 5);
                    setFeedback({ type: 'success', text: 'Top! ðŸŒŸ' });
                    setTimeout(() => {
                        if (currentProblem.category === 'german') generateGerman();
                        else if (currentProblem.category === 'flags') generateFlag();
                        else generateTopo(currentProblem.category);
                    }, 800);
                } else {
                    const correctVal = currentProblem.de || currentProblem.name || currentProblem.a;
                    setFeedback({ type: 'error', text: `Helaas! Het was ${correctVal}` });
                    setTimeout(() => setFeedback(null), 2000);
                }
            };

            const Header = ({ title, onBack, showLevel = false }) => (
                <div className="pt-12 pb-4 px-6 flex justify-between items-center bg-slate-900/80 backdrop-blur-md border-b border-white/5 sticky top-0 z-50">
                    <button onClick={onBack} className="text-slate-400 p-2 -ml-2"><Icon name="chevron-left" size={28} /></button>
                    <div className="flex flex-col items-center">
                        <h2 className="text-[10px] font-black uppercase tracking-[0.2em] italic text-slate-500">{title}</h2>
                        {showLevel && <span className="text-[10px] font-bold text-indigo-400">Level {mathLevel}</span>}
                    </div>
                    <div className="flex items-center gap-1.5 bg-orange-500/10 text-orange-500 px-3 py-1 rounded-full border border-orange-500/20">
                        <Icon name="trophy" size={14} /><span className="text-xs font-black">{score}</span>
                    </div>
                </div>
            );

            if (view === 'menu') {
                return (
                    <div className="app-container flex flex-col items-center justify-center p-6 text-center">
                        <h1 className="text-4xl font-black italic uppercase mb-8 tracking-tighter">Myrthe's<br/>Oefenmeester</h1>
                        <div className="grid grid-cols-2 gap-4 w-full max-w-sm">
                            <button onClick={() => setView('math-setup')} className="glass p-5 rounded-3xl flex flex-col items-center gap-2 active:scale-95 transition-all">
                                <div className="bg-indigo-600 p-3 rounded-2xl shadow-lg"><Icon name="calculator" /></div>
                                <span className="text-sm font-bold">Rekenen</span>
                            </button>
                            <button onClick={generateFlag} className="glass p-5 rounded-3xl flex flex-col items-center gap-2 active:scale-95 transition-all">
                                <div className="bg-emerald-600 p-3 rounded-2xl shadow-lg"><Icon name="flag" /></div>
                                <span className="text-sm font-bold">Vlaggen</span>
                            </button>
                            <button onClick={() => setView('topo-menu')} className="glass p-5 rounded-3xl flex flex-col items-center gap-2 active:scale-95 transition-all">
                                <div className="bg-amber-600 p-3 rounded-2xl shadow-lg"><Icon name="map" /></div>
                                <span className="text-sm font-bold">Topo</span>
                            </button>
                            <button onClick={generateGerman} className="glass p-5 rounded-3xl flex flex-col items-center gap-2 active:scale-95 transition-all">
                                <div className="bg-rose-600 p-3 rounded-2xl shadow-lg"><Icon name="languages" /></div>
                                <span className="text-sm font-bold">Duits</span>
                            </button>
                        </div>
                    </div>
                );
            }

            if (view === 'math-setup') {
                return (
                    <div className="app-container">
                        <Header title="Instellingen" onBack={() => setView('menu')} />
                        <div className="p-8 flex flex-col gap-4">
                            <h3 className="text-xl font-black italic uppercase">Wat gaan we doen?</h3>
                            <div className="grid grid-cols-2 gap-4">
                                {['plus', 'min', 'keer', 'gedeeld'].map(t => (
                                    <button key={t} onClick={() => setSelectedTypes(p => ({...p, [t]: !p[t]}))} className={`p-6 rounded-3xl border-2 transition-all font-black uppercase text-[10px] ${selectedTypes[t] ? 'bg-indigo-600 border-indigo-400' : 'bg-slate-900 border-transparent opacity-40'}`}>
                                        {t}
                                    </button>
                                ))}
                            </div>
                            <button onClick={generateMath} className="mt-4 w-full bg-white text-slate-950 py-5 rounded-3xl font-black text-xl italic uppercase">Start! ðŸš€</button>
                        </div>
                    </div>
                );
            }

            if (view === 'math-game') {
                return (
                    <div className="app-container">
                        <Header title="Rekenen" showLevel={true} onBack={() => setView('menu')} />
                        <div className="flex-1 flex flex-col items-center justify-center p-6">
                            <div className="flex gap-2 mb-4">
                                {[...Array(5)].map((_, i) => (
                                    <div key={i} className={`w-3 h-3 rounded-full ${i < mathStreak ? 'bg-indigo-400 shadow-lg' : 'bg-slate-800'}`} />
                                ))}
                            </div>
                            <div className="text-5xl font-black mb-6">{mathProblem.q}</div>
                            <div className="text-5xl font-mono bg-slate-900 w-full max-w-[200px] py-4 rounded-3xl border-2 border-slate-800 flex items-center justify-center text-indigo-400">
                                {userAnswer || "?"}
                            </div>
                            <div className="h-10 mt-4 text-sm font-black uppercase">
                                {feedback && <div className={feedback.type === 'success' ? 'text-emerald-400' : 'text-rose-400'}>{feedback.text}</div>}
                            </div>
                        </div>
                        <div className="bg-slate-900/90 p-6 pb-10 rounded-t-[2.5rem]">
                            <div className="numpad-grid max-w-xs mx-auto">
                                {[1,2,3,4,5,6,7,8,9,'C',0,'OK'].map(b => (
                                    <button key={b} onClick={() => {
                                        if(b === 'OK') {
                                            if(parseInt(userAnswer) === mathProblem.a) {
                                                const ns = mathStreak + 1;
                                                setScore(s => s + 2);
                                                if(ns >= 5) { setMathLevel(l => l + 1); setMathStreak(0); setFeedback({type:'success', text:'LEVEL UP!'}); }
                                                else { setMathStreak(ns); setFeedback({type:'success', text:'Lekker!'}); }
                                                setTimeout(generateMath, 800);
                                            } else {
                                                setFeedback({type:'error', text:`Fout! Het was ${mathProblem.a}`});
                                                setMathStreak(0);
                                                setTimeout(() => {setFeedback(null); setUserAnswer('');}, 1500);
                                            }
                                        } else if(b === 'C') setUserAnswer('');
                                        else if(userAnswer.length < 5) setUserAnswer(userAnswer + b);
                                    }} className="h-14 rounded-2xl bg-white/5 font-black text-xl">
                                        {b}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'flag-game') {
                return (
                    <div className="app-container">
                        <Header title="Vlaggen" onBack={() => setView('menu')} />
                        <div className="flex-1 flex flex-col items-center justify-center p-8 gap-6 text-center">
                            <h2 className="text-3xl font-black italic uppercase text-emerald-400 leading-tight">{currentProblem.q}</h2>
                            <div className="grid grid-cols-2 gap-4 w-full">
                                {currentProblem.opts.map((o, i) => (
                                    <button key={i} onClick={() => handleAnswer(o.name)} className="glass aspect-[3/2] rounded-2xl overflow-hidden active:scale-95 transition-all">
                                        <img src={o.flag} className="w-full h-full object-cover" />
                                    </button>
                                ))}
                            </div>
                            <div className="h-10 text-sm font-black uppercase">
                                {feedback && <div className={feedback.type === 'success' ? 'text-emerald-400' : 'text-rose-400'}>{feedback.text}</div>}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'topo-menu') {
                return (
                    <div className="app-container">
                        <Header title="Topografie" onBack={() => setView('menu')} />
                        <div className="p-8 flex flex-col gap-4 justify-center flex-1">
                            <button onClick={() => generateTopo('nederland')} className="glass p-6 rounded-3xl text-left border-l-4 border-amber-500">
                                <b className="block text-lg">Nederland</b>
                                <span className="text-[10px] text-slate-500 font-black uppercase">Provincies</span>
                            </button>
                            <button onClick={() => generateTopo('europa')} className="glass p-6 rounded-3xl text-left border-l-4 border-emerald-500">
                                <b className="block text-lg">Europa</b>
                                <span className="text-[10px] text-slate-500 font-black uppercase">Landen</span>
                            </button>
                        </div>
                    </div>
                );
            }

            if (view === 'topo-game') {
                return (
                    <div className="app-container">
                        <Header title="Topografie" onBack={() => setView('topo-menu')} />
                        <div className="flex-1 flex flex-col p-6 items-center gap-6 overflow-y-auto">
                            <div className="map-container w-full max-w-[280px] glass p-4 rounded-3xl">
                                <svg viewBox="0 0 320 350">
                                    {topoQuestions[currentProblem.category].map(p => (
                                        <path key={p.id} d={p.path} className={p.id === currentProblem.id ? 'province-active' : 'province-default'} />
                                    ))}
                                </svg>
                            </div>
                            <div className="grid grid-cols-1 gap-2 w-full max-w-xs">
                                {currentProblem.opts.map((o, i) => (
                                    <button key={i} onClick={() => handleAnswer(o)} className="glass p-4 rounded-2xl font-bold active:bg-white/10">
                                        {o}
                                    </button>
                                ))}
                            </div>
                            <div className="h-10 text-sm font-black uppercase">
                                {feedback && <div className={feedback.type === 'success' ? 'text-emerald-400' : 'text-rose-400'}>{feedback.text}</div>}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'german-game') {
                return (
                    <div className="app-container">
                        <Header title="Lidl Duits" onBack={() => setView('menu')} />
                        <div className="flex-1 flex flex-col p-8 items-center justify-center gap-8 text-center">
                            <h2 className="text-2xl font-black italic">{currentProblem.nl}</h2>
                            <div className="grid grid-cols-1 gap-3 w-full">
                                {currentProblem.opts.map((o, i) => (
                                    <button key={i} onClick={() => handleAnswer(o)} className="glass p-5 rounded-2xl font-bold text-sm">
                                        {o}
                                    </button>
                                ))}
                            </div>
                            <div className="h-10 text-sm font-black uppercase">
                                {feedback && <div className={feedback.type === 'success' ? 'text-emerald-400' : 'text-rose-400'}>{feedback.text}</div>}
                            </div>
                        </div>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>