<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Myrthe's Oefenmeester</title>
    
    <!-- PWA & Icon Tags -->
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/joris-db/oefenmeester/refs/heads/main/icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

 <!-- start webpushr tracking code --> 
    <script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = "https://cdn.webpushr.com/app.min.js";
    fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk-alternative'));
    webpushr('init','BE3We82PbRdwBzZZ5c0SwG7iysKjYc8MLkVwgzVVv2OyBtmM8Zt-JqDP63PmxZY1KyjfIXv3OhBb4kEWmlbz0Mw','https://joris-db.github.io/oefenmeester/webpushr-sw.js','/oefenmeester/');</script>
    <!-- end webpushr tracking code -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root { --slate-950: #020617; }
        body { 
            background-color: var(--slate-950); 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 0; height: 100vh; overflow: hidden;
            -webkit-tap-highlight-color: transparent; user-select: none; color: white;
        }
        .app-container { height: 100vh; display: flex; flex-direction: column; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .numpad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .scroll-hide::-webkit-scrollbar { display: none; }
        
        .flag-card {
            aspect-ratio: 3 / 2;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 1rem;
            background: #1e293b;
            padding: 4px;
            transition: all 0.2s;
        }
        .flag-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.75rem; }

        @keyframes levelUp {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-levelup { animation: levelUp 0.4s ease-out; }
        
        .progress-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #6366f1, #a855f7); transition: width 0.5s ease-out; }

        .correct-highlight { border: 4px solid #10b981 !important; transform: scale(1.05); z-index: 10; }
        .wrong-highlight { border: 4px solid #f43f5e !important; opacity: 0.7; }
        
        /* App Icon Styling */
        .app-logo {
            width: 56px;
            height: 56px;
            border-radius: 1.25rem;
            object-fit: cover;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        /* Notification Settings Styling */
        .notification-settings {
            margin-top: 2rem;
            padding: 1rem;
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.05);
            text-align: center;
            width: 100%;
            max-width: 320px;
        }
        .notification-settings p {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const appId = 'myrthe-oefenmeester-v8';
        const APP_ICON_URL = "https://raw.githubusercontent.com/joris-db/oefenmeester/refs/heads/main/icon.png";

        const germanLidlWords = [
            { nl: "De vergadering", de: "Besprechung" }, { nl: "De afspraak", de: "Termin" }, { nl: "De collega", de: "Kollege" }, { nl: "De afdeling", de: "Abteilung" },
            { nl: "Het kantoor", de: "BÃ¼ro" }, { nl: "De e-mail", de: "E-Mail" }, { nl: "De bijlage", de: "Anhang" }, { nl: "Het verslag", de: "Protokoll" },
            { nl: "De deadline", de: "Frist" }, { nl: "De opdracht", de: "Auftrag" }, { nl: "De planning", de: "Planung" }, { nl: "De strategie", de: "Strategie" },
            { nl: "De doelstelling", de: "Zielsetzung" }, { nl: "Het project", de: "Projekt" }, { nl: "De feedback", de: "RÃ¼ckmeldung" }, { nl: "De presentatie", de: "PrÃ¤sentation" },
            { nl: "De inkoop", de: "Einkauf" }, { nl: "De leverancier", de: "Lieferant" }, { nl: "De onderhandeling", de: "Verhandlung" }, { nl: "De prijs", de: "Preis" },
            { nl: "De klant", de: "Kunde" }, { nl: "De korting", de: "Rabatt" }, { nl: "De factuur", de: "Rechnung" }, { nl: "De voorraad", de: "Lagerbestand" },
            { nl: "De aanbieding", de: "Angebot" }, { nl: "De supermarkt", de: "Supermarkt" }, { nl: "De kassa", de: "Kasse" }, { nl: "De medewerker", de: "Mitarbeiter" },
            { nl: "Het filiaal", de: "Filiale" }, { nl: "De manager", de: "GeschÃ¤ftsfÃ¼hrer" }, { nl: "Het magazijn", de: "Lager" }, { nl: "De vrachtwagen", de: "LKW" },
            { nl: "Het product", de: "Produkt" }, { nl: "De kwaliteit", de: "QualitÃ¤t" }, { nl: "De versheid", de: "Frische" }, { nl: "De verpakking", de: "Verpackung" },
            { nl: "Het schap", de: "Regal" }, { nl: "De mand", de: "Korb" }, { nl: "De kar", de: "Einkaufswagen" }, { nl: "De bon", de: "Quittung" }
        ];

        const compliments = [
            "Myrthe, jij bent een vlaggen-wonder!",
            "Super gedaan Myrthe, je bent een topper!",
            "Wat een meesterbrein is die Myrthe toch!",
            "Myrthe gaat als een raket vandaag! ðŸš€",
            "Niemand doet het zoals Myrthe! âœ¨",
            "Myrthe, je bent onstuitbaar!",
            "Echt een Myrthe-actie: gewoon perfect!",
            "Wauw Myrthe, wat ben je slim!",
            "Myrthe de Grote slaat weer toe!",
            "Je bent een natuurtalent, Myrthe!"
        ];

        const encouragement = [
            "Geen zorgen Myrthe, de volgende heb je!",
            "Bijna Myrthe! Blijf focussen.",
            "Myrthe, laat je niet kisten, je kunt dit!",
            "Zelfs Myrthe maakt wel eens een foutje, op naar de volgende!",
            "Even goed kijken Myrthe, je weet het wel!",
            "Kop op Myrthe, je bent nog steeds de beste!"
        ];

        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    iconRef.current.innerHTML = '';
                    const iconElement = document.createElement('i');
                    iconElement.setAttribute('data-lucide', name);
                    iconElement.style.width = `${size}px`;
                    iconElement.style.height = `${size}px`;
                    if (className) iconElement.setAttribute('class', className);
                    iconRef.current.appendChild(iconElement);
                    window.lucide.createIcons();
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center" />;
        };

        const App = () => {
            const [view, setView] = useState('menu');
            const [countries, setCountries] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const [selectedChoice, setSelectedChoice] = useState(null);
            
            const [stats, setStats] = useState(() => {
                const saved = localStorage.getItem(`${appId}_stats`);
                return saved ? JSON.parse(saved) : {
                    xp: 0, level: 1, streak: 0,
                    correctMath: 0, correctGerman: 0, correctFlags: 0,
                    mathLevel: 1, flagBestStreak: 0,
                    totalPoints: 0, 
                    badges: []
                };
            });

            const [examState, setExamState] = useState(null);
            const [streakCount, setStreakCount] = useState(0);
            const [mathProblem, setMathProblem] = useState({ q: '', a: 0 });
            const [userAnswer, setUserAnswer] = useState('');
            const [mathStreak, setMathStreak] = useState(0);
            const [selectedTypes, setSelectedTypes] = useState({ plus: true, min: true, keer: false, gedeeld: false });
            const [currentProblem, setCurrentProblem] = useState(null);

            const getXpThreshold = (level) => Math.floor(100 * Math.pow(1.15, level - 1));

            useEffect(() => {
                localStorage.setItem(`${appId}_stats`, JSON.stringify(stats));
            }, [stats]);

            useEffect(() => {
                const loadCountries = async () => {
                    try {
                        const response = await fetch('https://restcountries.com/v3.1/all?fields=name,translations,flags');
                        if (!response.ok) throw new Error('API Error');
                        const data = await response.json();
                        const formatted = data.map(c => ({
                            name: c.translations?.nld?.common || c.name?.common,
                            flag: c.flags?.svg || c.flags?.png
                        })).filter(c => c.name && c.flag);
                        setCountries(formatted);
                    } catch (error) {
                        setCountries([
                            {name: "Nederland", flag: "https://flagcdn.com/nl.svg"},
                            {name: "Duitsland", flag: "https://flagcdn.com/de.svg"},
                            {name: "Frankrijk", flag: "https://flagcdn.com/fr.svg"},
                            {name: "BelgiÃ«", flag: "https://flagcdn.com/be.svg"}
                        ]);
                    }
                };
                loadCountries();
            }, []);

            const addXP = (amount, categoryKey) => {
                setStats(prev => {
                    let newXP = prev.xp + amount;
                    let currentLevel = prev.level;
                    let threshold = getXpThreshold(currentLevel);
                    let newBadges = [...prev.badges];

                    while (newXP >= threshold) {
                        newXP -= threshold;
                        currentLevel++;
                        threshold = getXpThreshold(currentLevel);
                        setFeedback({ type: 'success', text: `LEVEL UP! Level ${currentLevel} ðŸŽ‰` });
                    }

                    if (prev.correctMath + 1 >= 50 && !newBadges.includes('reken_wonder')) newBadges.push('reken_wonder');
                    if (prev.flagBestStreak >= 10 && !newBadges.includes('vlaggen_koning')) newBadges.push('vlaggen_koning');

                    return { 
                        ...prev, 
                        xp: newXP, 
                        level: currentLevel, 
                        totalPoints: prev.totalPoints + amount,
                        badges: newBadges,
                        [categoryKey]: (prev[categoryKey] || 0) + 1
                    };
                });
            };

            const getRandomFeedback = (isCorrect) => {
                const arr = isCorrect ? compliments : encouragement;
                return arr[Math.floor(Math.random() * arr.length)];
            };

            const generateFlagProblemData = (mode = 'flags') => {
                if (!countries.length) return null;
                
                let activeType = mode;
                if (mode === 'mixed') {
                    activeType = Math.random() > 0.5 ? 'flags' : 'landen-raden';
                }

                const correct = countries[Math.floor(Math.random() * countries.length)];
                let opts = [correct];
                while(opts.length < 4) {
                    const r = countries[Math.floor(Math.random() * countries.length)];
                    if(!opts.find(o => o.name === r.name)) opts.push(r);
                }
                
                return { 
                    ...correct, 
                    opts: opts.sort(() => Math.random() - 0.5), 
                    category: activeType,
                    originalMode: mode 
                };
            };

            const generateMathProblem = (level, types = null) => {
                const opsPool = types || Object.keys(selectedTypes).filter(k => selectedTypes[k]);
                const type = opsPool.length > 0 ? opsPool[Math.floor(Math.random() * opsPool.length)] : 'plus';
                let n1, n2, q, a;
                const range = level * 10;
                switch(type) {
                    case 'plus': n1 = Math.floor(Math.random() * range) + 2; n2 = Math.floor(Math.random() * range) + 2; q = `${n1} + ${n2}`; a = n1 + n2; break;
                    case 'min': n1 = Math.floor(Math.random() * range) + 10; n2 = Math.floor(Math.random() * (n1 - 2)) + 2; q = `${n1} - ${n2}`; a = n1 - n2; break;
                    case 'keer': n1 = Math.floor(Math.random() * 10) + 1; n2 = Math.floor(Math.random() * 10) + 1; q = `${n1} Ã— ${n2}`; a = n1 * n2; break;
                    case 'gedeeld': n2 = Math.floor(Math.random() * 9) + 2; a = Math.floor(Math.random() * 10) + 1; n1 = n2 * a; q = `${n1} : ${n2}`; break;
                }
                return { q, a };
            };

            const generateGermanProblem = () => {
                const correct = germanLidlWords[Math.floor(Math.random() * germanLidlWords.length)];
                let opts = [correct.de];
                while(opts.length < 4) {
                    const r = germanLidlWords[Math.floor(Math.random() * germanLidlWords.length)].de;
                    if(!opts.includes(r)) opts.push(r);
                }
                return { ...correct, opts: opts.sort(() => Math.random() - 0.5), category: 'german' };
            };

            const handleChoiceAnswer = (ans) => {
                if (feedback) return;
                setSelectedChoice(ans);
                
                const isCorrect = (currentProblem.category === 'german') 
                    ? (ans === currentProblem.de) 
                    : (ans.name === currentProblem.name);

                if (view === 'exam-choice') { 
                    setFeedback({ type: isCorrect ? 'success' : 'error', text: isCorrect ? 'Goed!' : 'Oei!' });
                    setTimeout(() => {
                        setFeedback(null);
                        setSelectedChoice(null);
                        nextExamQuestion(isCorrect); 
                    }, 1000);
                    return; 
                }

                if (view === 'flag-streak') {
                    if (isCorrect) {
                        const newStreak = streakCount + 1;
                        setStreakCount(newStreak);
                        if (newStreak > stats.flagBestStreak) setStats(prev => ({ ...prev, flagBestStreak: newStreak }));
                        addXP(10, 'correctFlags');
                        setFeedback({ type: 'success', text: `${getRandomFeedback(true)} (${newStreak} ðŸ”¥)` });
                        setTimeout(() => { 
                            setFeedback(null); 
                            setSelectedChoice(null);
                            setCurrentProblem(generateFlagProblemData('flags')); 
                        }, 1000);
                    } else {
                        setFeedback({ type: 'error', text: `Helaas Myrthe! Dit was ${currentProblem.name}.` });
                        setTimeout(() => {
                            setFeedback(null);
                            setSelectedChoice(null);
                            setView('menu');
                        }, 2500);
                    }
                    return;
                }

                if (isCorrect) {
                    addXP(20, (currentProblem.category.includes('flags') || currentProblem.category.includes('landen')) ? 'correctFlags' : 'correctGerman');
                    setFeedback({ type: 'success', text: getRandomFeedback(true) });
                    setTimeout(() => { 
                        setFeedback(null); 
                        setSelectedChoice(null);
                        if (currentProblem.category === 'german') {
                            setCurrentProblem(generateGermanProblem());
                        } else {
                            setCurrentProblem(generateFlagProblemData(currentProblem.originalMode || currentProblem.category));
                        }
                    }, 1200);
                } else {
                    setFeedback({ type: 'error', text: getRandomFeedback(false) });
                    setTimeout(() => {
                        setFeedback(null);
                        setSelectedChoice(null);
                    }, 1800);
                }
            };

            const handleMathAnswer = () => {
                if (feedback || !userAnswer) return;
                const isCorrect = parseInt(userAnswer) === mathProblem.a;
                if (view === 'exam-math') { nextExamQuestion(isCorrect); return; }
                if (isCorrect) {
                    addXP(25, 'correctMath');
                    setMathStreak(s => {
                        const next = s + 1;
                        if (next >= 5) setStats(p => ({ ...p, mathLevel: p.mathLevel + 1 }));
                        return next >= 5 ? 0 : next;
                    });
                    setFeedback({type:'success', text: getRandomFeedback(true)});
                    setTimeout(() => {
                        setMathProblem(generateMathProblem(stats.mathLevel));
                        setUserAnswer('');
                        setFeedback(null);
                    }, 1000);
                } else {
                    setFeedback({type:'error', text: getRandomFeedback(false) + ` (Het was ${mathProblem.a})`});
                    setMathStreak(0);
                    setTimeout(() => {setFeedback(null); setUserAnswer('');}, 2200);
                }
            };

            const startExam = (type) => {
                setExamState({ type, currentQuestion: 1, correctCount: 0, totalQuestions: 20 });
                setFeedback(null);
                setSelectedChoice(null);
                if (type === 'math') {
                    setMathProblem(generateMathProblem(stats.mathLevel));
                    setView('exam-math');
                } else {
                    setCurrentProblem(type === 'german' ? generateGermanProblem() : generateFlagProblemData('flags'));
                    setView('exam-choice');
                }
            };

            const nextExamQuestion = (isCorrect) => {
                const newCorrectCount = isCorrect ? examState.correctCount + 1 : examState.correctCount;
                if (examState.currentQuestion >= examState.totalQuestions) {
                    const percentage = Math.round((newCorrectCount / examState.totalQuestions) * 100);
                    setExamState(prev => ({ ...prev, correctCount: newCorrectCount, finished: true, passed: percentage >= 80, percentage }));
                    setView('exam-result');
                } else {
                    setExamState(prev => ({ ...prev, currentQuestion: prev.currentQuestion + 1, correctCount: newCorrectCount }));
                    if (examState.type === 'math') {
                        setMathProblem(generateMathProblem(stats.mathLevel));
                        setUserAnswer('');
                    } else {
                        setCurrentProblem(examState.type === 'german' ? generateGermanProblem() : generateFlagProblemData('flags'));
                    }
                }
            };

            const Header = ({ title, onBack }) => (
                <div className="pt-12 pb-4 px-6 flex justify-between items-center bg-slate-900/90 border-b border-white/5 sticky top-0 z-50">
                    <button onClick={() => { setFeedback(null); setSelectedChoice(null); onBack(); }} className="text-slate-400 p-2 active:scale-90"><Icon name="chevron-left" size={24} /></button>
                    <div className="text-center">
                        <h2 className="text-[10px] font-black uppercase tracking-widest text-slate-500 italic">{title}</h2>
                        <div className="flex items-center justify-center gap-1 text-orange-500 font-bold text-xs">
                            <Icon name="flame" size={14} /> {stats.streak} dag streak
                        </div>
                    </div>
                    <button onClick={() => setView('achievements')} className="bg-indigo-500/10 text-indigo-400 px-3 py-1 rounded-full border border-indigo-500/20 font-black text-xs">
                        LVL {stats.level}
                    </button>
                </div>
            );

            if (view === 'menu') {
                const threshold = getXpThreshold(stats.level);
                const progress = (stats.xp / threshold) * 100;
                
                return (
                    <div className="app-container p-6 flex flex-col items-center overflow-y-auto scroll-hide">
                        <div className="w-full max-w-sm pt-8 mb-8 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <img src={APP_ICON_URL} className="app-logo" alt="logo" />
                                <div><p className="text-[10px] font-black text-slate-500 uppercase">Myrthe's</p><p className="text-xl font-black italic uppercase tracking-tighter">Oefenmeester</p></div>
                            </div>
                            <button onClick={() => setView('achievements')} className="w-12 h-12 glass rounded-2xl flex items-center justify-center text-orange-400"><Icon name="trophy" size={20} /></button>
                        </div>

                        <div className="w-full max-w-sm mb-8 glass p-4 rounded-2xl">
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-[10px] font-black uppercase text-slate-400">Level {stats.level} Voortgang</span>
                                <span className="text-[10px] font-black text-indigo-400">{Math.round(stats.xp)} / {threshold} XP</span>
                            </div>
                            <div className="progress-bar"><div className="progress-fill" style={{ width: `${progress}%` }} /></div>
                        </div>

                        <div className="w-full max-w-sm space-y-4">
                            <h3 className="text-xs font-black uppercase text-slate-500 tracking-widest">Kies een vak</h3>
                            <button onClick={() => setView('math-category')} className="w-full glass p-6 rounded-[2rem] flex items-center gap-6 active:scale-95 border-l-4 border-indigo-500"><div className="bg-indigo-600 p-4 rounded-2xl shadow-lg"><Icon name="calculator" size={28} /></div><div className="text-left"><span className="block text-xl font-black italic uppercase">Rekenen</span><span className="text-[10px] font-bold text-slate-500 uppercase">Niveau {stats.mathLevel}</span></div></button>
                            <button onClick={() => setView('german-category')} className="w-full glass p-6 rounded-[2rem] flex items-center gap-6 active:scale-95 border-l-4 border-rose-500"><div className="bg-rose-600 p-4 rounded-2xl shadow-lg"><Icon name="languages" size={28} /></div><div className="text-left"><span className="block text-xl font-black italic uppercase">Duits</span><span className="text-[10px] font-bold text-slate-500 uppercase">Lidl woorden oefenen</span></div></button>
                            <button onClick={() => setView('flags-category')} className="w-full glass p-6 rounded-[2rem] flex items-center gap-6 active:scale-95 border-l-4 border-emerald-500"><div className="bg-emerald-600 p-4 rounded-2xl shadow-lg"><Icon name="flag" size={28} /></div><div className="text-left"><span className="block text-xl font-black italic uppercase">Vlaggen</span><span className="text-[10px] font-bold text-slate-500 uppercase">Landen en vlaggen</span></div></button>
                        </div>

                        <div className="notification-settings">
                           <p>Wil je op de hoogte blijven?</p>
                           <span id="webpushr-subscription-toggle-button" data-size="1.1" data-text-when-denied="Je hebt meldingen geblokkeerd." data-tooltip-position="right" data-color="#2c7be5"></span>
                        </div>
                    </div>
                );
            }

            if (view === 'math-setup') {
                return (
                    <div className="app-container">
                        <Header title="Training" onBack={() => setView('math-category')} />
                        <div className="p-8 flex flex-col gap-4 flex-1 justify-center max-w-sm mx-auto w-full">
                            <h3 className="text-2xl font-black italic uppercase text-center mb-4">Kies je sommen</h3>
                            <div className="grid grid-cols-2 gap-4">
                                {['plus', 'min', 'keer', 'gedeeld'].map(t => (
                                    <button key={t} onClick={() => setSelectedTypes(p => ({...p, [t]: !p[t]}))} className={`p-6 rounded-3xl border-2 transition-all font-black uppercase text-[10px] flex flex-col items-center gap-2 ${selectedTypes[t] ? 'bg-indigo-600 border-indigo-400' : 'bg-slate-900 border-white/5 opacity-40'}`}>
                                        <span className="text-2xl font-bold">{t === 'plus' ? '+' : t === 'min' ? '-' : t === 'keer' ? 'Ã—' : ':'}</span>{t}
                                    </button>
                                ))}
                            </div>
                            <button onClick={() => { setMathProblem(generateMathProblem(stats.mathLevel)); setUserAnswer(''); setView('math-game'); }} className="mt-8 bg-white text-slate-950 p-6 rounded-[2rem] font-black text-xl italic uppercase shadow-xl active:scale-95">Start Oefenen! ðŸš€</button>
                        </div>
                    </div>
                );
            }

            if (view === 'math-game' || view === 'exam-math') {
                const isExam = view === 'exam-math';
                return (
                    <div className="app-container">
                        <Header title={isExam ? `Toets: ${examState.currentQuestion}/${examState.totalQuestions}` : "Sommen"} onBack={() => setView('menu')} />
                        <div className="flex-1 flex flex-col items-center justify-center p-6 text-center">
                            {!isExam && <div className="flex gap-2 mb-6">{[...Array(5)].map((_, i) => (<div key={i} className={`w-3 h-3 rounded-full ${i < mathStreak ? 'bg-indigo-400' : 'bg-slate-800'}`} />))}</div>}
                            <div className="text-7xl font-black mb-10 tracking-tighter drop-shadow-2xl">{mathProblem.q}</div>
                            <div className="text-5xl font-mono bg-slate-900 w-full max-w-[240px] py-6 rounded-[2.5rem] border-2 border-indigo-500/30 flex items-center justify-center text-indigo-400 shadow-inner">{userAnswer || "?"}</div>
                            <div className="h-20 mt-6 px-4">
                                {feedback && (
                                    <div className={`font-black uppercase text-sm text-center px-6 py-3 rounded-2xl shadow-xl leading-snug ${feedback.type === 'success' ? 'bg-emerald-500 animate-levelup' : 'bg-rose-500'}`}>
                                        {feedback.text}
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="bg-slate-900/95 p-6 pb-12 rounded-t-[3rem] glass border-t border-white/5"><div className="numpad-grid max-w-xs mx-auto">{[1,2,3,4,5,6,7,8,9,'C',0,'OK'].map(b => (<button key={b} onClick={() => { if(b === 'OK') handleMathAnswer(); else if(b === 'C') setUserAnswer(''); else if(userAnswer.length < 5) setUserAnswer(userAnswer + b); }} className="h-16 rounded-2xl bg-white/5 font-black text-2xl active:bg-white/20 shadow-lg border border-white/5">{b}</button>))}</div></div>
                    </div>
                );
            }

            if ((view === 'german-game' || view === 'flags-game' || view === 'exam-choice' || view === 'flag-streak' || view === 'landen-raden' || view === 'mixed-game') && currentProblem) {
                const isFlags = currentProblem.category === 'flags';
                const isLandenRaden = currentProblem.category === 'landen-raden';
                const isGerman = currentProblem.category === 'german';

                return (
                    <div className="app-container">
                        <Header title={view === 'flag-streak' ? `Streak: ${streakCount}` : (view === 'mixed-game' ? "Gemixte Modus" : (isFlags ? "Vlaggen Zoeken" : (isLandenRaden ? "Landen Raden" : "Duits")))} onBack={() => setView('menu')} />
                        <div className="flex-1 flex flex-col p-8 items-center justify-start gap-4 text-center overflow-y-auto pt-8 scroll-hide">
                            <div className="space-y-3">
                                <span className="text-slate-500 uppercase text-[10px] font-black tracking-widest block">
                                    {isFlags ? "Zoek de vlag van" : (isLandenRaden ? "Van welk land is deze vlag?" : "Vertaal naar het Duits")}
                                </span>
                                {isLandenRaden ? (
                                    <div className="w-full max-w-[280px] mx-auto flag-card p-0 shadow-2xl overflow-hidden mb-4 border-2 border-white/10">
                                        <img src={currentProblem.flag} className="flag-img" alt="guess" />
                                    </div>
                                ) : (
                                    <h2 className="text-3xl font-black italic tracking-tighter text-white drop-shadow-lg">{isFlags ? currentProblem.name : currentProblem.nl}</h2>
                                )}
                            </div>
                            
                            <div className={`grid ${isFlags ? 'grid-cols-2' : 'grid-cols-1'} gap-4 w-full max-w-sm mt-4`}>
                                {currentProblem.opts.map((o, i) => {
                                    const isThisCorrect = isLandenRaden ? (o.name === currentProblem.name) : (isGerman ? (o === currentProblem.de) : (o.name === currentProblem.name));
                                    const isSelected = selectedChoice === o;
                                    const showTruth = feedback && feedback.type === 'error';
                                    
                                    return (
                                        <button 
                                            key={i} 
                                            onClick={() => handleChoiceAnswer(o)} 
                                            className={`
                                                ${isFlags ? 'flag-card active:scale-95 shadow-lg' : 'p-5 rounded-[1.5rem] font-bold text-lg active:scale-95'} 
                                                glass border-2 transition-all duration-200
                                                ${isSelected && !isThisCorrect ? 'wrong-highlight' : ''}
                                                ${showTruth && isThisCorrect ? 'correct-highlight' : 'border-transparent'}
                                            `}
                                        >
                                            {isFlags ? <img src={o.flag} className="flag-img" alt="flag" /> : (isLandenRaden ? o.name : o)}
                                        </button>
                                    );
                                })}
                            </div>
                            <div className="h-20 mt-4 flex items-center justify-center px-4 w-full">
                                {feedback && (
                                    <div className={`font-black uppercase text-sm text-center px-6 py-3 rounded-2xl shadow-2xl leading-tight ${feedback.type === 'success' ? 'bg-emerald-500 animate-levelup' : 'bg-rose-500'}`}>
                                        {feedback.text}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'exam-result') {
                return (
                    <div className="app-container flex flex-col items-center justify-center p-8 text-center">
                        <div className={`w-32 h-32 rounded-full flex items-center justify-center mb-6 shadow-2xl ${examState.passed ? 'bg-emerald-500' : 'bg-rose-500'}`}><Icon name={examState.passed ? "check" : "x"} size={64} /></div>
                        <h2 className="text-4xl font-black italic uppercase mb-2 tracking-tighter">{examState.passed ? 'Geslaagd!' : 'Gezakt...'}</h2>
                        <div className="text-6xl font-black text-white/90 mb-8">{examState.percentage}%</div>
                        <button onClick={() => setView('menu')} className="w-full max-w-sm bg-indigo-600 p-5 rounded-3xl font-black uppercase italic active:scale-95 shadow-xl shadow-indigo-500/20">Terug naar menu</button>
                    </div>
                );
            }

            if (view === 'achievements') {
                const badges = [
                    { id: 'reken_wonder', icon: 'zap', name: 'Reken Wonder', desc: '50 goede sommen', color: 'indigo' },
                    { id: 'vlaggen_koning', icon: 'crown', name: 'Vlaggen Koning', desc: 'Streak van 10+', color: 'emerald' },
                    { id: 'lidl_expert', icon: 'shopping-cart', name: 'Lidl Expert', desc: 'Duits niveau 5', color: 'rose' }
                ];
                return (
                    <div className="app-container">
                        <Header title="Statistieken" onBack={() => setView('menu')} />
                        <div className="flex-1 overflow-y-auto p-6 scroll-hide space-y-6">
                            <div className="grid grid-cols-2 gap-4">
                                <div className="glass p-6 rounded-3xl text-center"><div className="text-orange-500 mb-2 flex justify-center"><Icon name="flame" size={32} /></div><div className="text-2xl font-black">{stats.streak}</div><div className="text-[10px] font-bold text-slate-500 uppercase">Dagen</div></div>
                                <div className="glass p-6 rounded-3xl text-center"><div className="text-indigo-500 mb-2 flex justify-center"><Icon name="star" size={32} /></div><div className="text-2xl font-black">{stats.level}</div><div className="text-[10px] font-bold text-slate-500 uppercase">Level</div></div>
                                <div className="glass p-6 rounded-3xl text-center"><div className="text-emerald-500 mb-2 flex justify-center"><Icon name="trending-up" size={32} /></div><div className="text-2xl font-black">{stats.flagBestStreak}</div><div className="text-[10px] font-bold text-slate-500 uppercase">Beste Flag Streak</div></div>
                                <div className="glass p-6 rounded-3xl text-center"><div className="text-rose-500 mb-2 flex justify-center"><Icon name="award" size={32} /></div><div className="text-2xl font-black">{stats.totalPoints}</div><div className="text-[10px] font-bold text-slate-500 uppercase">Totaal XP</div></div>
                            </div>

                            <h3 className="text-xs font-black uppercase text-slate-500 tracking-widest mt-8">Je Badges</h3>
                            <div className="space-y-3">
                                {badges.map(b => {
                                    const unlocked = stats.badges.includes(b.id);
                                    return (
                                        <div key={b.id} className={`glass p-4 rounded-2xl flex items-center gap-4 border-l-4 ${unlocked ? `border-${b.color}-500` : 'border-slate-800 opacity-40 grayscale'}`}>
                                            <div className={`${unlocked ? `bg-${b.color}-600` : 'bg-slate-800'} p-3 rounded-xl`}><Icon name={b.icon} size={20} /></div>
                                            <div><div className="font-black italic text-sm uppercase">{b.name}</div><div className="text-[10px] font-bold text-slate-500 uppercase">{b.desc}</div></div>
                                            {unlocked && <div className="ml-auto text-emerald-400"><Icon name="check-circle" size={16} /></div>}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view.includes('-category')) {
                const type = view.split('-')[0];
                const config = {
                    math: { title: "Rekenen", color: "indigo", opts: [{ name: 'Training', desc: 'Sommen maken', icon: 'graduation-cap', action: () => setView('math-setup') }, { name: 'Toets', desc: '20 vragen', icon: 'scroll-text', action: () => startExam('math') }] },
                    german: { title: "Duits", color: "rose", opts: [{ name: 'Oefenen', desc: 'Woorden leren', icon: 'book-open', action: () => { setCurrentProblem(generateGermanProblem()); setView('german-game'); } }, { name: 'Toets', desc: '20 vragen', icon: 'scroll-text', action: () => startExam('german') }] },
                    flags: { title: "Vlaggen", color: "emerald", opts: [
                        { name: 'Vlag Zoeken', desc: 'Kies de vlag bij de naam', icon: 'search', action: () => { setCurrentProblem(generateFlagProblemData('flags')); setView('flags-game'); } }, 
                        { name: 'Landen Raden', desc: 'Kies de naam bij de vlag', icon: 'map-pin', action: () => { setCurrentProblem(generateFlagProblemData('landen-raden')); setView('landen-raden'); } },
                        { name: 'Gemixte Modus', desc: 'Beide types door elkaar', icon: 'shuffle', action: () => { setCurrentProblem(generateFlagProblemData('mixed')); setView('mixed-game'); } },
                        { name: 'Streak', desc: `Record: ${stats.flagBestStreak}`, icon: 'zap', action: () => { setStreakCount(0); setCurrentProblem(generateFlagProblemData('flags')); setView('flag-streak'); } }, 
                        { name: 'Toets', desc: '20 landen', icon: 'scroll-text', action: () => startExam('flags') }
                    ]}
                }[type];
                
                return (
                    <div className="app-container">
                        <Header title={config.title} onBack={() => setView('menu')} />
                        <div className="p-8 flex flex-col gap-5 justify-center flex-1 max-w-sm mx-auto w-full overflow-y-auto scroll-hide">
                            {config.opts.map((opt, i) => (
                                <button key={i} onClick={opt.action} disabled={type === 'flags' && countries.length === 0} className={`w-full glass p-5 rounded-[2.2rem] flex items-center gap-6 active:scale-95 border-b-4 border-${config.color}-500/50`}>
                                    <div className={`bg-${config.color}-600 p-4 rounded-2xl shadow-lg`}><Icon name={opt.icon} size={22} /></div>
                                    <div className="text-left"><span className="block text-lg font-black italic uppercase leading-tight">{opt.name}</span><span className="text-[10px] font-bold text-slate-500 uppercase">{opt.desc}</span></div>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>