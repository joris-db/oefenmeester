<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Myrthe's Oefenmeester</title>

    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/joris-db/oefenmeester/refs/heads/main/icon.png">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/joris-db/oefenmeester/refs/heads/main/icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Oefenmeester">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root { --slate-950: #020617; }
        body { 
            background-color: var(--slate-950); 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 0; height: 100vh; overflow: hidden;
            -webkit-tap-highlight-color: transparent; user-select: none; color: white;
        }
        .app-container { height: 100vh; display: flex; flex-direction: column; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .numpad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .scroll-hide::-webkit-scrollbar { display: none; }
        
        .flag-card {
            aspect-ratio: 3 / 2;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 1rem;
            background: #1e293b;
            padding: 4px;
        }
        .flag-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.75rem; }

        @keyframes levelUp {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-levelup { animation: levelUp 0.5s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const appId = 'myrthe-oefenmeester-v2';

        const germanLidlWords = [
            { nl: "De vergadering", de: "Besprechung" }, { nl: "De afspraak", de: "Termin" }, { nl: "De collega", de: "Kollege" }, { nl: "De afdeling", de: "Abteilung" },
            { nl: "Het kantoor", de: "BÃ¼ro" }, { nl: "De e-mail", de: "E-Mail" }, { nl: "De bijlage", de: "Anhang" }, { nl: "Het verslag", de: "Protokoll" },
            { nl: "De deadline", de: "Frist" }, { nl: "De opdracht", de: "Auftrag" }, { nl: "De planning", de: "Planung" }, { nl: "De strategie", de: "Strategie" },
            { nl: "De doelstelling", de: "Zielsetzung" }, { nl: "Het project", de: "Projekt" }, { nl: "De feedback", de: "RÃ¼ckmeldung" }, { nl: "De presentatie", de: "PrÃ¤sentation" },
            { nl: "De inkoop", de: "Einkauf" }, { nl: "De leverancier", de: "Lieferant" }, { nl: "De onderhandeling", de: "Verhandlung" }, { nl: "De prijs", de: "Preis" },
            { nl: "De klant", de: "Kunde" }, { nl: "De korting", de: "Rabatt" }, { nl: "De factuur", de: "Rechnung" }, { nl: "De voorraad", de: "Lagerbestand" },
            { nl: "De aanbieding", de: "Angebot" }, { nl: "De supermarkt", de: "Supermarkt" }, { nl: "De kassa", de: "Kasse" }, { nl: "De medewerker", de: "Mitarbeiter" },
            { nl: "Het filiaal", de: "Filiale" }, { nl: "De manager", de: "GeschÃ¤ftsfÃ¼hrer" }, { nl: "Het magazijn", de: "Lager" }, { nl: "De vrachtwagen", de: "LKW" },
            { nl: "Het product", de: "Produkt" }, { nl: "De kwaliteit", de: "QualitÃ¤t" }, { nl: "De versheid", de: "Frische" }, { nl: "De verpakking", de: "Verpackung" },
            { nl: "Het schap", de: "Regal" }, { nl: "De mand", de: "Korb" }, { nl: "De kar", de: "Einkaufswagen" }, { nl: "De bon", de: "Quittung" }
        ];

        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    iconRef.current.innerHTML = '';
                    const iconElement = document.createElement('i');
                    iconElement.setAttribute('data-lucide', name);
                    iconElement.style.width = `${size}px`;
                    iconElement.style.height = `${size}px`;
                    if (className) iconElement.setAttribute('class', className);
                    iconRef.current.appendChild(iconElement);
                    window.lucide.createIcons();
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center" />;
        };

        const App = () => {
            const [view, setView] = useState('menu');
            const [countries, setCountries] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const [lastWords, setLastWords] = useState([]); 
            
            const [stats, setStats] = useState(() => {
                const saved = localStorage.getItem(`${appId}_stats`);
                return saved ? JSON.parse(saved) : {
                    xp: 0,
                    level: 1,
                    streak: 0,
                    lastDate: null,
                    correctMath: 0,
                    correctGerman: 0,
                    correctFlags: 0,
                    mathLevel: 1,
                    flagBestStreak: 0
                };
            });

            // Toets state
            const [examState, setExamState] = useState(null); // { type, currentQuestion, correctCount, totalQuestions: 40, history: [] }
            const [streakCount, setStreakCount] = useState(0);

            const getXpThreshold = (level) => Math.floor(100 * Math.pow(1.1, level - 1));

            useEffect(() => {
                localStorage.setItem(`${appId}_stats`, JSON.stringify(stats));
            }, [stats]);

            useEffect(() => {
                const today = new Date().toDateString();
                if (stats.lastDate !== today) {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const wasYesterday = stats.lastDate === yesterday.toDateString();
                    setStats(prev => ({
                        ...prev,
                        lastDate: today,
                        streak: wasYesterday ? prev.streak + 1 : (prev.lastDate ? 1 : 0)
                    }));
                }
            }, []);

            useEffect(() => {
                fetch('https://restcountries.com/v3.1/all?fields=name,flags,translations')
                    .then(r => r.json())
                    .then(data => {
                        const formatted = data.map(c => ({
                            name: c.translations.nld?.common || c.name.common,
                            flag: c.flags.svg
                        })).filter(c => c.name && c.flag);
                        setCountries(formatted);
                    });
            }, []);

            const [mathProblem, setMathProblem] = useState({ q: '', a: 0 });
            const [userAnswer, setUserAnswer] = useState('');
            const [mathStreak, setMathStreak] = useState(0);
            const [selectedTypes, setSelectedTypes] = useState({ plus: true, min: true, keer: false, gedeeld: false });
            const [currentProblem, setCurrentProblem] = useState(null);

            const addXP = (amount, categoryKey) => {
                setStats(prev => {
                    let newXP = prev.xp + amount;
                    let currentLevel = prev.level;
                    let threshold = getXpThreshold(currentLevel);
                    while (newXP >= threshold) {
                        newXP -= threshold;
                        currentLevel++;
                        threshold = getXpThreshold(currentLevel);
                        setFeedback({ type: 'success', text: `LEVEL UP! Level ${currentLevel} ðŸŽ‰` });
                    }
                    const updates = { ...prev, xp: newXP, level: currentLevel };
                    if (categoryKey) updates[categoryKey] = (prev[categoryKey] || 0) + 1;
                    return updates;
                });
            };

            const generateMathProblem = (level, types = null) => {
                const opsPool = types || Object.keys(selectedTypes).filter(k => selectedTypes[k]);
                const type = opsPool[Math.floor(Math.random() * opsPool.length)];
                let n1, n2, q, a;
                const minVal = Math.max(2, Math.floor(level / 2));
                switch(type) {
                    case 'plus': n1 = Math.floor(Math.random() * (level * 15)) + minVal; n2 = Math.floor(Math.random() * (level * 15)) + minVal; q = `${n1} + ${n2}`; a = n1 + n2; break;
                    case 'min': n1 = Math.floor(Math.random() * (level * 15)) + (minVal * 2); n2 = Math.floor(Math.random() * (n1 - minVal)) + minVal; q = `${n1} - ${n2}`; a = n1 - n2; break;
                    case 'keer': n1 = Math.floor(Math.random() * 10) + 1; n2 = Math.floor(Math.random() * 10) + 1; q = `${n1} Ã— ${n2}`; a = n1 * n2; break;
                    case 'gedeeld': n2 = Math.floor(Math.random() * 9) + 2; a = Math.floor(Math.random() * 10) + 1; n1 = n2 * a; q = `${n1} : ${n2}`; break;
                }
                return { q, a };
            };

            const startMathGame = useCallback(() => {
                const prob = generateMathProblem(stats.mathLevel);
                setMathProblem(prob);
                setUserAnswer('');
                setFeedback(null);
                setView('math-game');
            }, [selectedTypes, stats.mathLevel]);

            const generateGermanProblem = () => {
                const availableWords = germanLidlWords.filter(w => !lastWords.includes(w.de));
                const pool = availableWords.length > 0 ? availableWords : germanLidlWords;
                const correct = pool[Math.floor(Math.random() * pool.length)];
                setLastWords(prev => [correct.de, ...prev].slice(0, 10));

                let opts = [correct.de];
                while(opts.length < 4) {
                    const r = germanLidlWords[Math.floor(Math.random() * germanLidlWords.length)].de;
                    if(!opts.includes(r)) opts.push(r);
                }
                return { ...correct, opts: opts.sort(() => Math.random() - 0.5), category: 'german' };
            };

            const startGermanGame = () => {
                setCurrentProblem(generateGermanProblem());
                setFeedback(null);
                setView('german-game');
            };

            const generateFlagProblemData = () => {
                if (!countries.length) return null;
                const correct = countries[Math.floor(Math.random() * countries.length)];
                let opts = [correct];
                while(opts.length < 4) {
                    const r = countries[Math.floor(Math.random() * countries.length)];
                    if(!opts.find(o => o.name === r.name)) opts.push(r);
                }
                return { ...correct, opts: opts.sort(() => Math.random() - 0.5), category: 'flags' };
            };

            const startFlagGame = () => {
                setCurrentProblem(generateFlagProblemData());
                setFeedback(null);
                setView('flags-game');
            };

            const startStreakMode = () => {
                setStreakCount(0);
                setCurrentProblem(generateFlagProblemData());
                setFeedback(null);
                setView('flag-streak');
            };

            const startExam = (type) => {
                setExamState({
                    type,
                    currentQuestion: 1,
                    correctCount: 0,
                    totalQuestions: 40,
                    level: stats.mathLevel // alleen voor rekenen relevant
                });
                
                if (type === 'math') {
                    setMathProblem(generateMathProblem(stats.mathLevel, ['plus', 'min', 'keer', 'gedeeld']));
                    setUserAnswer('');
                    setView('exam-math');
                } else if (type === 'german') {
                    setCurrentProblem(generateGermanProblem());
                    setView('exam-choice');
                } else if (type === 'flags') {
                    setCurrentProblem(generateFlagProblemData());
                    setView('exam-choice');
                }
                setFeedback(null);
            };

            const nextExamQuestion = (isCorrect) => {
                const newCorrectCount = isCorrect ? examState.correctCount + 1 : examState.correctCount;
                if (examState.currentQuestion >= examState.totalQuestions) {
                    // Einde toets
                    const percentage = Math.round((newCorrectCount / examState.totalQuestions) * 100);
                    const passed = percentage >= 85;
                    if (passed) addXP(200); // Bonus voor slagen
                    setExamState(prev => ({ ...prev, correctCount: newCorrectCount, finished: true, passed, percentage }));
                    setView('exam-result');
                } else {
                    setExamState(prev => ({ ...prev, currentQuestion: prev.currentQuestion + 1, correctCount: newCorrectCount }));
                    if (examState.type === 'math') {
                        setMathProblem(generateMathProblem(examState.level, ['plus', 'min', 'keer', 'gedeeld']));
                        setUserAnswer('');
                    } else if (examState.type === 'german') {
                        setCurrentProblem(generateGermanProblem());
                    } else if (examState.type === 'flags') {
                        setCurrentProblem(generateFlagProblemData());
                    }
                }
            };

            const handleChoiceAnswer = (ans) => {
                if (feedback) return;
                
                const isCorrect = (currentProblem.category === 'german') 
                    ? ans === currentProblem.de 
                    : ans.name === currentProblem.name;

                if (view === 'exam-choice') {
                    nextExamQuestion(isCorrect);
                    return;
                }

                if (view === 'flag-streak') {
                    if (isCorrect) {
                        const newStreak = streakCount + 1;
                        setStreakCount(newStreak);
                        if (newStreak > stats.flagBestStreak) {
                            setStats(prev => ({ ...prev, flagBestStreak: newStreak }));
                        }
                        addXP(5, 'correctFlags');
                        setFeedback({ type: 'success', text: `Streak: ${newStreak}! ðŸ”¥` });
                        setTimeout(() => {
                            setFeedback(null);
                            setCurrentProblem(generateFlagProblemData());
                        }, 600);
                    } else {
                        setFeedback({ type: 'error', text: `Helaas! Dit was ${ans.name}. Je streak: ${streakCount}` });
                        setTimeout(() => setView('menu'), 2500);
                    }
                    return;
                }

                if (isCorrect) {
                    const cat = currentProblem.category === 'german' ? 'correctGerman' : 'correctFlags';
                    addXP(15, cat);
                    setFeedback({ type: 'success', text: 'Lekker bezig! âœ¨' });
                    setTimeout(() => {
                        if (currentProblem.category === 'german') startGermanGame();
                        else startFlagGame();
                    }, 800);
                } else {
                    const text = (currentProblem.category === 'german') 
                        ? `Jammer! Het was ${currentProblem.de}` 
                        : `Nee, dit is de vlag van ${ans.name}`;
                    setFeedback({ type: 'error', text });
                    setTimeout(() => setFeedback(null), 2500);
                }
            };

            const handleMathAnswer = () => {
                if (feedback) return;
                const isCorrect = parseInt(userAnswer) === mathProblem.a;

                if (view === 'exam-math') {
                    nextExamQuestion(isCorrect);
                    return;
                }

                if (isCorrect) {
                    addXP(20, 'correctMath');
                    setMathStreak(s => {
                        const n = s + 1;
                        if(n >= 5) {
                            setStats(prev => ({...prev, mathLevel: prev.mathLevel + 1}));
                            return 0;
                        }
                        return n;
                    });
                    setFeedback({type:'success', text:'Lekker hoor! âœ¨'});
                    setTimeout(startMathGame, 800);
                } else {
                    setFeedback({type:'error', text:`Nee, het was ${mathProblem.a}`});
                    setMathStreak(0);
                    setTimeout(() => {setFeedback(null); setUserAnswer('');}, 2000);
                }
            };

            const Header = ({ title, onBack }) => (
                <div className="pt-12 pb-4 px-6 flex justify-between items-center bg-slate-900/90 border-b border-white/5 sticky top-0 z-50">
                    <button onClick={onBack} className="text-slate-400 p-2 active:scale-90"><Icon name="chevron-left" size={24} /></button>
                    <div className="text-center">
                        <h2 className="text-[10px] font-black uppercase tracking-widest text-slate-500 italic">{title}</h2>
                        <div className="flex items-center justify-center gap-1 text-orange-500 font-bold text-xs">
                            <Icon name="flame" size={14} /> {stats.streak} dag streak
                        </div>
                    </div>
                    <button onClick={() => setView('achievements')} className="bg-indigo-500/10 text-indigo-400 px-3 py-1 rounded-full border border-indigo-500/20 font-black text-xs active:scale-95">
                        LVL {stats.level}
                    </button>
                </div>
            );

            if (view === 'menu') {
                const threshold = getXpThreshold(stats.level);
                return (
                    <div className="app-container p-6 flex flex-col items-center overflow-y-auto scroll-hide">
                        <div className="w-full max-w-sm pt-8 mb-4 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg font-black text-xl">M</div>
                                <div>
                                    <p className="text-[10px] font-black text-slate-500 uppercase">Dag Myrthe!</p>
                                    <p className="font-bold flex items-center gap-1">Level {stats.level} <Icon name="sparkles" size={14} className="text-yellow-400"/></p>
                                </div>
                            </div>
                            <button onClick={() => setView('achievements')} className="w-12 h-12 glass rounded-2xl flex items-center justify-center text-orange-400 active:scale-90">
                                <Icon name="trophy" size={20} />
                            </button>
                        </div>

                        <div className="w-full max-w-sm glass p-5 rounded-[2rem] mb-6">
                            <div className="flex justify-between items-end mb-2 text-[10px] font-black uppercase tracking-widest">
                                <span className="text-slate-400 italic">Level {stats.level}</span>
                                <span className="text-indigo-400 font-bold">{stats.xp} / {threshold} XP</span>
                            </div>
                            <div className="w-full bg-slate-800 h-3 rounded-full overflow-hidden">
                                <div className="bg-indigo-500 h-full transition-all duration-700" style={{ width: `${(stats.xp / threshold) * 100}%` }} />
                            </div>
                        </div>

                        <div className="w-full max-w-sm grid grid-cols-1 gap-4 mb-10 pb-8">
                            <h3 className="text-sm font-black italic uppercase text-slate-500">Oefenen</h3>
                            <div className="grid grid-cols-3 gap-3">
                                <button onClick={() => setView('math-setup')} className="glass p-4 rounded-3xl flex flex-col items-center gap-2 active:scale-95 transition-all text-center">
                                    <div className="bg-indigo-600 p-3 rounded-xl shadow-lg"><Icon name="calculator" size={20} /></div>
                                    <span className="font-bold text-[10px] uppercase">Sommen</span>
                                </button>
                                <button onClick={startGermanGame} className="glass p-4 rounded-3xl flex flex-col items-center gap-2 active:scale-95 transition-all text-center">
                                    <div className="bg-rose-600 p-3 rounded-xl shadow-lg"><Icon name="briefcase" size={20} /></div>
                                    <span className="font-bold text-[10px] uppercase">Duits</span>
                                </button>
                                <button onClick={startFlagGame} className="glass p-4 rounded-3xl flex flex-col items-center gap-2 active:scale-95 transition-all text-center">
                                    <div className="bg-emerald-600 p-3 rounded-xl shadow-lg"><Icon name="flag" size={20} /></div>
                                    <span className="font-bold text-[10px] uppercase">Vlaggen</span>
                                </button>
                            </div>

                            <h3 className="text-sm font-black italic uppercase text-slate-500 mt-2">Toetsen (40 vragen)</h3>
                            <div className="grid grid-cols-1 gap-3">
                                <button onClick={() => startExam('math')} className="glass p-4 rounded-3xl flex items-center justify-between active:scale-95 border-l-4 border-indigo-500">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-indigo-500/20 text-indigo-400 p-2 rounded-lg"><Icon name="scroll-text" size={20}/></div>
                                        <span className="font-bold uppercase italic text-sm">Rekentoets</span>
                                    </div>
                                    <Icon name="chevron-right" size={16} className="text-slate-600"/>
                                </button>
                                <button onClick={() => startExam('german')} className="glass p-4 rounded-3xl flex items-center justify-between active:scale-95 border-l-4 border-rose-500">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-rose-500/20 text-rose-400 p-2 rounded-lg"><Icon name="scroll-text" size={20}/></div>
                                        <span className="font-bold uppercase italic text-sm">Duits Toets</span>
                                    </div>
                                    <Icon name="chevron-right" size={16} className="text-slate-600"/>
                                </button>
                                <button onClick={() => startExam('flags')} className="glass p-4 rounded-3xl flex items-center justify-between active:scale-95 border-l-4 border-emerald-500">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-emerald-500/20 text-emerald-400 p-2 rounded-lg"><Icon name="scroll-text" size={20}/></div>
                                        <span className="font-bold uppercase italic text-sm">Vlaggen Toets</span>
                                    </div>
                                    <Icon name="chevron-right" size={16} className="text-slate-600"/>
                                </button>
                            </div>

                            <h3 className="text-sm font-black italic uppercase text-slate-500 mt-2">Extra</h3>
                            <button onClick={startStreakMode} className="glass p-4 rounded-3xl flex items-center justify-between active:scale-95 bg-gradient-to-r from-orange-500/10 to-transparent">
                                <div className="flex items-center gap-4">
                                    <div className="bg-orange-500 p-2 rounded-lg"><Icon name="zap" size={20}/></div>
                                    <div>
                                        <span className="block font-bold uppercase italic text-sm">Vlaggen Streak</span>
                                        <span className="text-[10px] text-orange-400 font-black uppercase">Record: {stats.flagBestStreak}</span>
                                    </div>
                                </div>
                                <Icon name="chevron-right" size={16} className="text-slate-600"/>
                            </button>
                        </div>
                    </div>
                );
            }

            if (view === 'achievements') {
                return (
                    <div className="app-container">
                        <Header title="Prestaties" onBack={() => setView('menu')} />
                        <div className="flex-1 overflow-y-auto p-6 scroll-hide">
                            <div className="grid grid-cols-2 gap-4">
                                <div className="glass p-6 rounded-3xl text-center shadow-xl">
                                    <div className="text-orange-500 mb-2 flex justify-center"><Icon name="flame" size={32} /></div>
                                    <div className="text-2xl font-black">{stats.streak}</div>
                                    <div className="text-[10px] font-bold text-slate-500 uppercase">Dagen Streak</div>
                                </div>
                                <div className="glass p-6 rounded-3xl text-center shadow-xl">
                                    <div className="text-indigo-500 mb-2 flex justify-center"><Icon name="star" size={32} /></div>
                                    <div className="text-2xl font-black">{stats.level}</div>
                                    <div className="text-[10px] font-bold text-slate-500 uppercase">Huidig Level</div>
                                </div>
                            </div>
                            <div className="mt-4 glass p-4 rounded-3xl text-center border-orange-500/20 border">
                                <div className="text-orange-400 mb-1 flex justify-center gap-2 items-center">
                                    <Icon name="zap" size={20} /> <span className="text-lg font-black">{stats.flagBestStreak}</span>
                                </div>
                                <div className="text-[10px] font-bold text-slate-500 uppercase">Beste Vlaggen Streak</div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'math-setup') {
                return (
                    <div className="app-container">
                        <Header title="Rekenen" onBack={() => setView('menu')} />
                        <div className="p-8 flex flex-col gap-4 flex-1 justify-center">
                            <h3 className="text-2xl font-black italic uppercase text-center mb-4">Kies je sommen</h3>
                            <div className="grid grid-cols-2 gap-4">
                                {['plus', 'min', 'keer', 'gedeeld'].map(t => (
                                    <button key={t} onClick={() => setSelectedTypes(p => ({...p, [t]: !p[t]}))} className={`p-8 rounded-[2rem] border-2 transition-all font-black uppercase text-xs flex flex-col items-center gap-2 ${selectedTypes[t] ? 'bg-indigo-600 border-indigo-400' : 'bg-slate-900 border-white/5 opacity-40'}`}>
                                        <span className="text-2xl">{t === 'plus' ? '+' : t === 'min' ? '-' : t === 'keer' ? 'Ã—' : ':'}</span>
                                        {t}
                                    </button>
                                ))}
                            </div>
                            <button onClick={startMathGame} className="mt-8 bg-white text-slate-950 p-6 rounded-[2rem] font-black text-xl italic uppercase shadow-xl active:scale-95 transition-all">Start! ðŸš€</button>
                        </div>
                    </div>
                );
            }

            if (view === 'math-game' || view === 'exam-math') {
                const isExam = view === 'exam-math';
                return (
                    <div className="app-container">
                        <Header title={isExam ? `Toets: ${examState.currentQuestion}/${examState.totalQuestions}` : "Sommen"} onBack={() => setView('menu')} />
                        <div className="flex-1 flex flex-col items-center justify-center p-6 text-center">
                            {!isExam && (
                                <div className="flex gap-2 mb-6">
                                    {[...Array(5)].map((_, i) => (
                                        <div key={i} className={`w-3 h-3 rounded-full ${i < mathStreak ? 'bg-indigo-400' : 'bg-slate-800'}`} />
                                    ))}
                                </div>
                            )}
                            <div className="text-6xl font-black mb-10 tracking-tighter drop-shadow-2xl">{mathProblem.q}</div>
                            <div className="text-5xl font-mono bg-slate-900 w-full max-w-[240px] py-6 rounded-[2.5rem] border-2 border-indigo-500/30 flex items-center justify-center text-indigo-400 shadow-inner">
                                {userAnswer || "?"}
                            </div>
                            <div className="h-16 mt-6">
                                {feedback && <div className={`font-black uppercase text-center px-8 py-3 rounded-2xl shadow-xl ${feedback.type === 'success' ? 'bg-emerald-500 animate-levelup' : 'bg-rose-500'}`}>{feedback.text}</div>}
                            </div>
                        </div>
                        <div className="bg-slate-900/95 p-6 pb-12 rounded-t-[3rem] glass border-t border-white/5">
                            <div className="numpad-grid max-w-xs mx-auto">
                                {[1,2,3,4,5,6,7,8,9,'C',0,'OK'].map(b => (
                                    <button key={b} onClick={() => {
                                        if(b === 'OK') handleMathAnswer();
                                        else if(b === 'C') setUserAnswer('');
                                        else if(userAnswer.length < 5) setUserAnswer(userAnswer + b);
                                    }} className="h-16 rounded-2xl bg-white/5 font-black text-2xl active:bg-white/20 transition-colors shadow-lg border border-white/5">
                                        {b}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'german-game' || view === 'flags-game' || view === 'exam-choice' || view === 'flag-streak') {
                const isFlags = (currentProblem.category === 'flags');
                const isExam = view === 'exam-choice';
                const isStreak = view === 'flag-streak';

                return (
                    <div className="app-container">
                        <Header 
                            title={isExam ? `Toets: ${examState.currentQuestion}/${examState.totalQuestions}` : (isStreak ? "Streak Mode" : (isFlags ? "Vlaggen" : "Lidl Duits"))} 
                            onBack={() => setView('menu')} 
                        />
                        <div className="flex-1 flex flex-col p-8 items-center justify-start gap-6 text-center overflow-y-auto pt-8 scroll-hide">
                            {isStreak && (
                                <div className="bg-orange-500/20 text-orange-400 px-4 py-2 rounded-full font-black text-sm border border-orange-500/30">
                                    Streak: {streakCount}
                                </div>
                            )}
                            <div className="space-y-2">
                                <span className="text-slate-500 uppercase text-[10px] font-black tracking-widest italic">{isFlags ? "Zoek de vlag van" : "Duitse vertaling van"}</span>
                                <h2 className={`text-3xl font-black italic tracking-tighter leading-tight ${isFlags ? 'text-emerald-400' : 'text-rose-400'}`}>{isFlags ? currentProblem.name : currentProblem.nl}</h2>
                            </div>
                            
                            <div className={`grid ${isFlags ? 'grid-cols-2' : 'grid-cols-1'} gap-4 w-full max-w-sm`}>
                                {currentProblem.opts.map((o, i) => (
                                    <button key={i} onClick={() => handleChoiceAnswer(o)} className={`${isFlags ? 'flag-card shadow-2xl active:scale-95' : 'p-5 rounded-[1.5rem] font-bold text-lg active:scale-95'} glass border-2 border-transparent active:border-white/40 transition-all`}>
                                        {isFlags ? <img src={o.flag} className="flag-img" /> : o}
                                    </button>
                                ))}
                            </div>

                            <div className="h-16 mt-4">
                                {feedback && (
                                    <div className={`font-black uppercase px-8 py-3 rounded-2xl shadow-2xl leading-tight ${feedback.type === 'success' ? 'bg-emerald-500 animate-levelup' : 'bg-rose-500'}`}>
                                        {feedback.text}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'exam-result') {
                return (
                    <div className="app-container flex flex-col items-center justify-center p-8 text-center">
                        <div className={`w-32 h-32 rounded-full flex items-center justify-center mb-6 shadow-2xl ${examState.passed ? 'bg-emerald-500 shadow-emerald-500/20' : 'bg-rose-500 shadow-rose-500/20'}`}>
                            <Icon name={examState.passed ? "check" : "x"} size={64} />
                        </div>
                        <h2 className="text-4xl font-black italic uppercase mb-2 tracking-tighter">
                            {examState.passed ? 'Geslaagd!' : 'Gezakt...'}
                        </h2>
                        <div className="text-6xl font-black text-white/90 mb-4">{examState.percentage}%</div>
                        <p className="text-slate-400 mb-10 max-w-xs">
                            Je hebt {examState.correctCount} van de {examState.totalQuestions} vragen goed beantwoord.
                            {examState.passed ? ' Super gedaan Myrthe! Je krijgt extra XP.' : ' Volgende keer beter, blijf oefenen!'}
                        </p>
                        <button onClick={() => setView('menu')} className="w-full max-w-sm bg-indigo-600 p-5 rounded-3xl font-black uppercase italic shadow-xl active:scale-95">Terug naar menu</button>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>